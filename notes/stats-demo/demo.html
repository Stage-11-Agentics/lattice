<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lattice Stats Demo — 27 Improvements</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0f1117;
      --bg-card: #1a1d27;
      --bg-card-hover: #222738;
      --accent: #6366f1;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border: #2d3348;
      --radius: 12px;
      --font: 'Inter', system-ui, -apple-system, sans-serif;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: var(--font);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    .page-header {
      max-width: 1000px; margin: 0 auto; padding: 3rem 2rem 2rem;
      border-bottom: 1px solid var(--border); margin-bottom: 2rem;
    }
    .page-header h1 { font-size: 2rem; font-weight: 800; letter-spacing: -0.02em; margin-bottom: 0.5rem; }
    .page-header h1 .accent { color: var(--accent); }
    .page-header .subtitle { font-size: 0.95rem; color: var(--text-secondary); max-width: 600px; }
    .page-header .meta { margin-top: 1rem; display: flex; gap: 1.5rem; font-size: 0.78rem; color: var(--text-muted); }
    .toc { max-width: 1000px; margin: 0 auto 3rem; padding: 0 2rem; }
    .toc h2 { font-size: 0.75rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 1rem; }
    .toc-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; }
    .toc-item { display: flex; align-items: center; gap: 0.6rem; padding: 0.5rem 0.75rem; border-radius: 8px; text-decoration: none; color: var(--text-secondary); font-size: 0.82rem; transition: background 0.15s, color 0.15s; }
    .toc-item:hover { background: var(--bg-card); color: var(--text-primary); }
    .toc-num { font-weight: 700; color: var(--accent); font-size: 0.75rem; min-width: 20px; }
    .toc-tag { margin-left: auto; font-size: 0.6rem; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; padding: 0.15em 0.5em; border-radius: 4px; background: rgba(99,102,241,0.08); color: var(--accent); flex-shrink: 0; }
    .main-content { max-width: 1000px; margin: 0 auto; padding: 0 2rem 4rem; }
    .demo-group { margin-bottom: 3rem; }
    .demo-group-title { font-size: 0.72rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-muted); padding: 1rem 0; border-top: 2px solid var(--border); margin-bottom: 2rem; }
    .demo-item { margin-bottom: 2.5rem; }
    .demo-item-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border); }
    .demo-item-number { font-size: 1.1rem; color: var(--accent); font-weight: 700; flex-shrink: 0; }
    .demo-item-header h3 { margin: 0; font-size: 1rem; font-weight: 600; color: var(--text-primary); font-family: var(--font); flex: 1; }
    .demo-item-tag { font-size: 0.65rem; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase; padding: 0.2em 0.6em; border-radius: 5px; background: rgba(99,102,241,0.1); color: var(--accent); border: 1px solid rgba(99,102,241,0.2); flex-shrink: 0; }
    .section-divider { font-size: 0.72rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-muted); padding: 1.5rem 0 1rem; border-top: 2px solid var(--border); margin-top: 2rem; margin-bottom: 1.5rem; }
    html { scroll-behavior: smooth; }
    @media (max-width: 768px) { .toc-grid { grid-template-columns: 1fr 1fr; } .page-header h1 { font-size: 1.5rem; } }
    @media (max-width: 480px) { .toc-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

<div class="page-header">
  <h1>Lattice Stats <span class="accent">Demo</span></h1>
  <p class="subtitle">27 proposed improvements to the dashboard stats page. Each section is numbered and self-contained with mock data. Review, pick favorites, and build.</p>
  <div class="meta">
    <span>27 items</span>
    <span>5 categories</span>
    <span>Mock data throughout</span>
  </div>
</div>

<div class="toc">
  <h2>Table of Contents</h2>
  <div class="toc-grid">
    <a class="toc-item" href="#item-1"><span class="toc-num">1</span> Health Banner <span class="toc-tag">Narrative</span></a>
    <a class="toc-item" href="#item-2"><span class="toc-num">2</span> Event Timeline <span class="toc-tag">Activity</span></a>
    <a class="toc-item" href="#item-3"><span class="toc-num">3</span> Executive Summary <span class="toc-tag">Narrative</span></a>
    <a class="toc-item" href="#item-4"><span class="toc-num">4</span> Velocity Sparklines <span class="toc-tag">Charts</span></a>
    <a class="toc-item" href="#item-5"><span class="toc-num">5</span> Cumulative Flow <span class="toc-tag">Charts</span></a>
    <a class="toc-item" href="#item-6"><span class="toc-num">6</span> Cycle + Lead Time <span class="toc-tag">Metrics</span></a>
    <a class="toc-item" href="#item-7"><span class="toc-num">7</span> Status Duration <span class="toc-tag">Analysis</span></a>
    <a class="toc-item" href="#item-8"><span class="toc-num">8</span> Donut Chart <span class="toc-tag">Charts</span></a>
    <a class="toc-item" href="#item-9"><span class="toc-num">9</span> Card Hierarchy <span class="toc-tag">Layout</span></a>
    <a class="toc-item" href="#item-10"><span class="toc-num">10</span> Dark Mode <span class="toc-tag">Polish</span></a>
    <a class="toc-item" href="#item-11"><span class="toc-num">11</span> Clickable Everything <span class="toc-tag">Polish</span></a>
    <a class="toc-item" href="#item-12"><span class="toc-num">12</span> Time Range <span class="toc-tag">Polish</span></a>
    <a class="toc-item" href="#item-13"><span class="toc-num">13</span> Collapsible Sections <span class="toc-tag">Polish</span></a>
    <a class="toc-item" href="#item-14"><span class="toc-num">14</span> Workload Balance <span class="toc-tag">Distribution</span></a>
    <a class="toc-item" href="#item-15"><span class="toc-num">15</span> Risk Stack <span class="toc-tag">Risk</span></a>
    <a class="toc-item" href="#item-16"><span class="toc-num">16</span> Burndown <span class="toc-tag">Charts</span></a>
    <a class="toc-item" href="#item-17"><span class="toc-num">17</span> Activity Heatmap <span class="toc-tag">Calendar</span></a>
    <a class="toc-item" href="#item-18"><span class="toc-num">18</span> Animations <span class="toc-tag">Interaction</span></a>
    <a class="toc-item" href="#item-19"><span class="toc-num">19</span> Empty States <span class="toc-tag">UX</span></a>
    <a class="toc-item" href="#item-20"><span class="toc-num">20</span> Export / Share <span class="toc-tag">Feature</span></a>
    <a class="toc-item" href="#item-21"><span class="toc-num">21</span> KPI Deltas <span class="toc-tag">Data</span></a>
    <a class="toc-item" href="#item-22"><span class="toc-num">22</span> WIP Severity <span class="toc-tag">Alert</span></a>
    <a class="toc-item" href="#item-23"><span class="toc-num">23</span> Bottleneck Detection <span class="toc-tag">Insight</span></a>
    <a class="toc-item" href="#item-24"><span class="toc-num">24</span> Dependency Chains <span class="toc-tag">Graph</span></a>
    <a class="toc-item" href="#item-25"><span class="toc-num">25</span> Human vs Agent <span class="toc-tag">Comparison</span></a>
    <a class="toc-item" href="#item-26"><span class="toc-num">26</span> Recommended Actions <span class="toc-tag">Feature</span></a>
    <a class="toc-item" href="#item-27"><span class="toc-num">27</span> Baseline / Goals <span class="toc-tag">Charts</span></a>
  </div>
</div>

<div class="main-content">
<div class="section-divider">Section 1 &mdash; Hero, Cards &amp; Narrative</div>
<!-- ============================================================
     Section 1: Health Banner, Executive Summary, Card Hierarchy,
                Animated Transitions, KPI Deltas
     ============================================================ -->

<style>
/* ── Section 1 Scoped Styles ───────────────────────────────── */

/* Health Banner ①  */
.health-banner {
  position: relative;
  overflow: hidden;
  background: linear-gradient(135deg, #131726 0%, #1a2340 40%, #1e2a4a 70%, #192038 100%);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 2.5rem 3rem;
  display: flex;
  align-items: center;
  gap: 2.5rem;
  font-family: var(--font);
}

.health-banner::before {
  content: '';
  position: absolute;
  top: -60%;
  right: -10%;
  width: 420px;
  height: 420px;
  background: radial-gradient(circle, rgba(99, 102, 241, 0.08) 0%, transparent 70%);
  pointer-events: none;
}

.health-banner::after {
  content: '';
  position: absolute;
  bottom: -40%;
  left: 20%;
  width: 300px;
  height: 300px;
  background: radial-gradient(circle, rgba(56, 189, 248, 0.05) 0%, transparent 70%);
  pointer-events: none;
}

.health-banner-weather {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  min-width: 100px;
}

.health-banner-weather-icon {
  font-size: 3rem;
  line-height: 1;
  filter: drop-shadow(0 2px 8px rgba(250, 204, 21, 0.25));
}

.health-banner-weather-label {
  font-size: 0.8rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--text-secondary);
}

.health-ring-container {
  position: relative;
  flex-shrink: 0;
}

.health-ring-svg {
  width: 110px;
  height: 110px;
  transform: rotate(-90deg);
}

.health-ring-bg {
  fill: none;
  stroke: var(--border);
  stroke-width: 7;
}

.health-ring-fg {
  fill: none;
  stroke: url(#healthGradient);
  stroke-width: 7;
  stroke-linecap: round;
  stroke-dasharray: 283;
  stroke-dashoffset: 283;
  transition: stroke-dashoffset 0.1s ease;
}

.health-ring-fg.animated {
  animation: ringFill 1.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

@keyframes ringFill {
  to { stroke-dashoffset: 79.24; }
}

.health-ring-label {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

.health-ring-score {
  font-size: 1.75rem;
  font-weight: 800;
  color: var(--text-primary);
  line-height: 1;
  font-variant-numeric: tabular-nums;
}

.health-ring-max {
  font-size: 0.7rem;
  color: var(--text-muted);
  font-weight: 500;
}

.health-banner-info {
  flex: 1;
  min-width: 0;
}

.health-banner-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0 0 0.35rem 0;
  display: flex;
  align-items: center;
  gap: 0.6rem;
}

.health-banner-title-badge {
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  padding: 0.2em 0.65em;
  border-radius: 6px;
  background: rgba(99, 102, 241, 0.15);
  color: var(--accent);
  border: 1px solid rgba(99, 102, 241, 0.25);
}

.health-banner-summary {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin: 0;
  line-height: 1.5;
}

.health-banner-summary .hl-warn {
  color: var(--warning);
  font-weight: 600;
}

.health-banner-summary .hl-danger {
  color: var(--danger);
  font-weight: 600;
}

.health-banner-summary .hl-success {
  color: var(--success);
  font-weight: 600;
}

.health-banner-summary .sep {
  color: var(--text-muted);
  margin: 0 0.15em;
}

/* Executive Summary ③  */
.exec-summary {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-left: 4px solid var(--accent);
  border-radius: 0 var(--radius) var(--radius) 0;
  padding: 1.5rem 2rem;
  font-family: var(--font);
  position: relative;
  overflow: hidden;
}

.exec-summary::before {
  content: '\201C';
  position: absolute;
  top: -0.15rem;
  left: 1rem;
  font-size: 4rem;
  color: rgba(99, 102, 241, 0.12);
  font-family: Georgia, serif;
  line-height: 1;
  pointer-events: none;
}

.exec-summary p {
  margin: 0;
  font-size: 0.92rem;
  line-height: 1.75;
  color: var(--text-secondary);
}

.exec-summary .hl {
  color: var(--text-primary);
  font-weight: 600;
}

.exec-summary .hl-warn {
  color: var(--warning);
  font-weight: 600;
}

.exec-summary .hl-danger {
  color: var(--danger);
  font-weight: 600;
}

.exec-summary .hl-accent {
  color: var(--accent);
  font-weight: 600;
}

/* Card Hierarchy ⑨ + KPI Deltas ㉑  */
.card-hierarchy {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  grid-template-rows: auto auto;
  gap: 1rem;
  font-family: var(--font);
}

.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.5rem;
  position: relative;
  overflow: hidden;
  transition: background 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
}

.stat-card:hover {
  background: var(--bg-card-hover);
  border-color: rgba(99, 102, 241, 0.3);
  transform: translateY(-2px);
}

/* Hero card spans all 3 columns */
.stat-card.hero {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  gap: 2rem;
  padding: 2rem 2.5rem;
  border-left: 4px solid var(--accent);
  background: linear-gradient(135deg, var(--bg-card) 0%, rgba(99, 102, 241, 0.04) 100%);
}

.stat-card.hero .stat-card-number {
  font-size: 4rem;
  font-weight: 800;
  color: var(--text-primary);
  line-height: 1;
  font-variant-numeric: tabular-nums;
  min-width: 100px;
}

.stat-card.hero .stat-card-meta {
  flex: 1;
}

.stat-card.hero .stat-card-label {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0 0 0.25rem 0;
}

.stat-card.hero .stat-card-sublabel {
  font-size: 0.82rem;
  color: var(--text-muted);
}

.stat-card.hero .kpi-delta {
  font-size: 0.85rem;
}

/* Secondary cards */
.stat-card.secondary {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  border-left: 3px solid var(--border);
  transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease;
}

.stat-card.secondary:nth-child(2) { border-left-color: var(--text-muted); }
.stat-card.secondary:nth-child(3) { border-left-color: var(--success); }
.stat-card.secondary:nth-child(4) { border-left-color: var(--warning); }

.stat-card.secondary .stat-card-number {
  font-size: 2rem;
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1.1;
  font-variant-numeric: tabular-nums;
}

.stat-card.secondary .stat-card-label {
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

/* KPI Deltas ㉑ */
.kpi-delta {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.75rem;
  font-weight: 600;
  padding: 0.2em 0.55em;
  border-radius: 6px;
  margin-top: 0.35rem;
  width: fit-content;
  font-variant-numeric: tabular-nums;
}

.kpi-delta.up {
  color: var(--success);
  background: rgba(34, 197, 94, 0.1);
  border: 1px solid rgba(34, 197, 94, 0.2);
}

.kpi-delta.down {
  color: var(--danger);
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.2);
}

.kpi-delta-arrow {
  font-size: 0.85em;
}

.kpi-delta-prev {
  font-size: 0.7rem;
  color: var(--text-muted);
  font-weight: 400;
  margin-left: 0.2em;
}

/* Animated Transitions ⑱ */
@keyframes fadeSlideUp {
  from {
    opacity: 0;
    transform: translateY(24px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes cardEntrance {
  from {
    opacity: 0;
    transform: translateY(16px) scale(0.97);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes borderGlow {
  0%   { border-left-color: var(--accent); }
  50%  { border-left-color: rgba(99, 102, 241, 0.6); }
  100% { border-left-color: var(--accent); }
}

.animate-on-scroll {
  opacity: 0;
  transform: translateY(24px);
}

.animate-on-scroll.in-view {
  animation: fadeSlideUp 0.7s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

.stat-card.animate-on-scroll.in-view {
  animation: cardEntrance 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

.stat-card.hero.animate-on-scroll.in-view {
  animation: cardEntrance 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

.stat-card.secondary:nth-child(2).animate-on-scroll.in-view { animation-delay: 0.08s; }
.stat-card.secondary:nth-child(3).animate-on-scroll.in-view { animation-delay: 0.16s; }
.stat-card.secondary:nth-child(4).animate-on-scroll.in-view { animation-delay: 0.24s; }

/* Demo item structure */
#group-1 .demo-item {
  margin-bottom: 2.5rem;
}

#group-1 .demo-item-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.25rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid var(--border);
}

#group-1 .demo-item-number {
  font-size: 1.1rem;
  color: var(--accent);
  font-weight: 700;
  flex-shrink: 0;
}

#group-1 .demo-item-header h3 {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
  font-family: var(--font);
  flex: 1;
}

#group-1 .demo-item-tag {
  font-size: 0.65rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  padding: 0.2em 0.6em;
  border-radius: 5px;
  background: rgba(99, 102, 241, 0.1);
  color: var(--accent);
  border: 1px solid rgba(99, 102, 241, 0.2);
  flex-shrink: 0;
}

#group-1 .demo-item-body {
  /* wrapper for the actual UI mockup */
}
</style>

<div class="demo-group" id="group-1">

  <!-- ① Project Health Score + Weather Banner -->
  <div class="demo-item" id="item-1">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9312;</span>
      <h3>Project Health Score + Weather Banner</h3>
      <span class="demo-item-tag">Narrative</span>
    </div>
    <div class="demo-item-body">
      <div class="health-banner animate-on-scroll">

        <div class="health-banner-weather">
          <span class="health-banner-weather-icon" aria-label="Partly Cloudy">&#9925;</span>
          <span class="health-banner-weather-label">Partly Cloudy</span>
        </div>

        <div class="health-ring-container">
          <svg class="health-ring-svg" viewBox="0 0 100 100" aria-label="Health score 72 out of 100">
            <defs>
              <linearGradient id="healthGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#6366f1" />
                <stop offset="100%" stop-color="#22c55e" />
              </linearGradient>
            </defs>
            <circle class="health-ring-bg" cx="50" cy="50" r="45" />
            <circle class="health-ring-fg" cx="50" cy="50" r="45" />
          </svg>
          <div class="health-ring-label">
            <div class="health-ring-score" data-countup="72">0</div>
            <div class="health-ring-max">/ 100</div>
          </div>
        </div>

        <div class="health-banner-info">
          <h2 class="health-banner-title">
            Project Health
            <span class="health-banner-title-badge">Live</span>
          </h2>
          <p class="health-banner-summary">
            <span class="hl-warn">3 tasks stale</span><span class="sep"> &middot; </span><span class="hl-danger">1 WIP breach</span><span class="sep"> &middot; </span><span class="hl-success">3 completed this week</span>
          </p>
        </div>

      </div>
    </div>
  </div>

  <!-- ③ Executive Summary Sentence -->
  <div class="demo-item" id="item-3">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9314;</span>
      <h3>Executive Summary Sentence</h3>
      <span class="demo-item-tag">Narrative</span>
    </div>
    <div class="demo-item-body">
      <div class="exec-summary animate-on-scroll">
        <p>
          <span class="hl">32 active tasks</span> across <span class="hl">6 statuses</span>.
          <span class="hl">3 completed</span> this week, <span class="hl">8</span> this month.
          <span class="hl-warn">2 tasks need attention</span>:
          <span class="hl-danger">LAT-18</span> is stale and blocking 2 others.
          <span class="hl-accent">In-progress WIP limit exceeded</span>
          (<span class="hl-danger">5/4</span>) for 3 days.
        </p>
      </div>
    </div>
  </div>

  <!-- ⑨ Card Hierarchy with Visual Weight + ㉑ KPI Deltas -->
  <div class="demo-item" id="item-9">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9320;</span>
      <h3>Card Hierarchy with Visual Weight</h3>
      <span class="demo-item-tag">Layout</span>
    </div>
    <div class="demo-item-body">
      <div class="card-hierarchy">

        <!-- Hero card -->
        <div class="stat-card hero animate-on-scroll">
          <div class="stat-card-number" data-countup="32">0</div>
          <div class="stat-card-meta">
            <div class="stat-card-label">Active Tasks</div>
            <div class="stat-card-sublabel">Across backlog, in-progress, review, and blocked</div>
            <div class="kpi-delta up">
              <span class="kpi-delta-arrow">&uarr;</span>3
              <span class="kpi-delta-prev">was 29</span>
            </div>
          </div>
        </div>

        <!-- Secondary cards -->
        <div class="stat-card secondary animate-on-scroll">
          <div class="stat-card-label">Archived</div>
          <div class="stat-card-number" data-countup="15">0</div>
          <div class="kpi-delta up">
            <span class="kpi-delta-arrow">&uarr;</span>2
            <span class="kpi-delta-prev">was 13</span>
          </div>
        </div>

        <div class="stat-card secondary animate-on-scroll">
          <div class="stat-card-label">Total Events</div>
          <div class="stat-card-number" data-countup="135">0</div>
          <div class="kpi-delta up">
            <span class="kpi-delta-arrow">&uarr;</span>18
            <span class="kpi-delta-prev">was 117</span>
          </div>
        </div>

        <div class="stat-card secondary animate-on-scroll">
          <div class="stat-card-label">Active Events</div>
          <div class="stat-card-number" data-countup="90">0</div>
          <div class="kpi-delta down">
            <span class="kpi-delta-arrow">&darr;</span>5
            <span class="kpi-delta-prev">was 95</span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ⑱ Animated Transitions (note: applied across all items above) -->
  <div class="demo-item" id="item-18">
    <div class="demo-item-header">
      <span class="demo-item-number">&#12881;</span>
      <h3>Animated Transitions</h3>
      <span class="demo-item-tag">Interaction</span>
    </div>
    <div class="demo-item-body">
      <div class="exec-summary animate-on-scroll" style="border-left-color: var(--text-muted);">
        <p>
          <span class="hl">All elements above use scroll-triggered animations.</span>
          The health ring fills via <span class="hl-accent">SVG stroke-dashoffset</span>,
          card numbers count up from zero with an <span class="hl-accent">easeOutExpo</span> curve,
          and each card enters with a staggered <span class="hl-accent">fadeSlideUp</span> transition.
          Animations fire once via <span class="hl">IntersectionObserver</span> when scrolled into view.
        </p>
      </div>
    </div>
  </div>

  <!-- ㉑ KPI Deltas on Cards (note: integrated into item-9 cards) -->
  <div class="demo-item" id="item-21">
    <div class="demo-item-header">
      <span class="demo-item-number">&#12882;</span>
      <h3>KPI Deltas on Cards</h3>
      <span class="demo-item-tag">Data</span>
    </div>
    <div class="demo-item-body">
      <div class="exec-summary animate-on-scroll" style="border-left-color: var(--success);">
        <p>
          <span class="hl">Each summary card above displays a 7-day delta badge.</span>
          <span class="hl-accent">Green &uarr;</span> indicates growth,
          <span class="hl-danger">Red &darr;</span> indicates decline.
          Badges show the change value and previous count for quick context.
          Deltas are positioned below the main metric for clean visual hierarchy.
        </p>
      </div>
    </div>
  </div>

</div>

<script>
(function() {
  'use strict';

  /* ── Counter Animation ──────────────────────────────────── */
  function animateCountUp(el, target, duration) {
    if (el.dataset.counted === 'true') return;
    el.dataset.counted = 'true';
    const start = performance.now();
    const from = 0;

    function easeOutExpo(t) {
      return t === 1 ? 1 : 1 - Math.pow(2, -10 * t);
    }

    function tick(now) {
      const elapsed = now - start;
      const progress = Math.min(elapsed / duration, 1);
      const value = Math.round(from + (target - from) * easeOutExpo(progress));
      el.textContent = value;
      if (progress < 1) {
        requestAnimationFrame(tick);
      } else {
        el.textContent = target;
      }
    }
    requestAnimationFrame(tick);
  }

  /* ── Ring Animation ─────────────────────────────────────── */
  function animateRing(ring) {
    if (ring.classList.contains('animated')) return;
    ring.classList.add('animated');
  }

  /* ── IntersectionObserver for scroll-triggered animations ─ */
  const observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      if (!entry.isIntersecting) return;

      const el = entry.target;

      // Trigger CSS fade/slide animation
      el.classList.add('in-view');

      // Trigger countup for any data-countup elements within
      const counters = el.querySelectorAll('[data-countup]');
      counters.forEach(function(counter) {
        const target = parseInt(counter.getAttribute('data-countup'), 10);
        // Slight delay so the card entrance animation starts first
        setTimeout(function() {
          animateCountUp(counter, target, 1400);
        }, 300);
      });

      // Trigger ring animation if present within this element
      const ring = el.querySelector('.health-ring-fg');
      if (ring) {
        setTimeout(function() {
          animateRing(ring);
        }, 400);
      }

      // Unobserve after triggering (fire once)
      observer.unobserve(el);
    });
  }, {
    threshold: 0.15,
    rootMargin: '0px 0px -40px 0px'
  });

  /* ── Observe all animate-on-scroll elements in this section ── */
  var group = document.getElementById('group-1');
  if (group) {
    var targets = group.querySelectorAll('.animate-on-scroll');
    targets.forEach(function(el) {
      observer.observe(el);
    });
  }
})();
</script>
<div class="section-divider">Section 2 &mdash; Activity &amp; People</div>
<style>
/* ============================================================
   Section 2 Styles
   ============================================================ */

/* --- Item #2: Event Timeline --- */
.event-timeline {
  display: flex;
  flex-direction: column;
  gap: 0;
  position: relative;
  padding-left: 32px;
}

.event-timeline::before {
  content: '';
  position: absolute;
  left: 11px;
  top: 8px;
  bottom: 8px;
  width: 2px;
  background: var(--border);
  border-radius: 1px;
}

.timeline-event {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  padding: 12px 0;
  position: relative;
  cursor: default;
  border-radius: 8px;
  transition: background 0.2s ease;
}

.timeline-event:hover {
  background: var(--bg-card-hover);
  margin-left: -8px;
  padding-left: 8px;
  margin-right: -8px;
  padding-right: 8px;
}

.timeline-dot {
  position: absolute;
  left: -28px;
  top: 16px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  z-index: 1;
  box-shadow: 0 0 0 3px var(--bg-card);
  flex-shrink: 0;
}

.timeline-dot.dot-done { background: var(--success); }
.timeline-dot.dot-status { background: var(--accent); }
.timeline-dot.dot-comment { background: #a855f7; }
.timeline-dot.dot-create { background: var(--warning); }
.timeline-dot.dot-assign { background: #38bdf8; }

.timeline-time {
  font-size: 12px;
  color: var(--text-muted);
  min-width: 52px;
  flex-shrink: 0;
  padding-top: 2px;
  font-variant-numeric: tabular-nums;
}

.timeline-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.timeline-action {
  font-size: 14px;
  color: var(--text-primary);
  line-height: 1.4;
}

.timeline-action .task-ref {
  color: var(--accent);
  font-weight: 600;
}

.timeline-action .status-label {
  font-weight: 500;
}

.timeline-action .comment-text {
  color: var(--text-secondary);
  font-style: italic;
}

.actor-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  font-weight: 500;
  padding: 2px 8px;
  border-radius: 10px;
  white-space: nowrap;
}

.actor-pill.actor-agent {
  background: rgba(99, 102, 241, 0.15);
  color: #818cf8;
}

.actor-pill.actor-human {
  background: rgba(34, 197, 94, 0.15);
  color: #4ade80;
}

/* --- Item #14: Assignee Workload Balance --- */
.workload-balance {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.workload-row {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.workload-row.unassigned-row {
  border: 1px dashed var(--warning);
  border-radius: 8px;
  padding: 12px;
  background: rgba(245, 158, 11, 0.04);
}

.workload-label-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.workload-assignee {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
}

.workload-total {
  font-size: 12px;
  color: var(--text-secondary);
  font-weight: 500;
}

.workload-bar-track {
  height: 24px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 6px;
  overflow: hidden;
  display: flex;
  position: relative;
}

.workload-segment {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.85);
  transition: opacity 0.2s ease;
  position: relative;
  min-width: 2px;
}

.workload-segment:hover {
  opacity: 0.85;
}

.workload-segment[data-status="backlog"] { background: #475569; }
.workload-segment[data-status="in_planning"] { background: #7c3aed; }
.workload-segment[data-status="planned"] { background: #6366f1; }
.workload-segment[data-status="in_progress"] { background: #3b82f6; }
.workload-segment[data-status="review"] { background: #f59e0b; }
.workload-segment[data-status="done"] { background: #22c55e; }
.workload-segment[data-status="blocked"] { background: #ef4444; }

.workload-legend {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 8px;
  padding-top: 12px;
  border-top: 1px solid var(--border);
}

.workload-legend-item {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 11px;
  color: var(--text-muted);
}

.workload-legend-swatch {
  width: 10px;
  height: 10px;
  border-radius: 3px;
  flex-shrink: 0;
}

.workload-segment-tooltip {
  display: none;
  position: absolute;
  bottom: calc(100% + 6px);
  left: 50%;
  transform: translateX(-50%);
  background: #1e2030;
  color: var(--text-primary);
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 11px;
  white-space: nowrap;
  pointer-events: none;
  z-index: 10;
  border: 1px solid var(--border);
}

.workload-segment:hover .workload-segment-tooltip {
  display: block;
}

/* --- Item #17: Activity Heatmap --- */
.heatmap-container {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.heatmap-month-labels {
  display: flex;
  padding-left: 36px;
  gap: 0;
  margin-bottom: 2px;
}

.heatmap-month-label {
  font-size: 11px;
  color: var(--text-muted);
  font-weight: 500;
}

.heatmap-grid-wrapper {
  display: flex;
  gap: 6px;
}

.heatmap-day-labels {
  display: flex;
  flex-direction: column;
  gap: 0;
  padding-top: 0;
}

.heatmap-day-label {
  font-size: 10px;
  color: var(--text-muted);
  height: 14px;
  line-height: 14px;
  margin-bottom: 3px;
  text-align: right;
  padding-right: 4px;
  font-weight: 500;
}

.heatmap-day-label:last-child {
  margin-bottom: 0;
}

.heatmap-grid {
  display: flex;
  gap: 3px;
}

.heatmap-column {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.heatmap-cell {
  width: 14px;
  height: 14px;
  border-radius: 3px;
  cursor: default;
  position: relative;
  transition: outline 0.15s ease;
}

.heatmap-cell:hover {
  outline: 2px solid var(--text-muted);
  outline-offset: 1px;
}

.heatmap-cell.level-0 { background: #1e2030; }
.heatmap-cell.level-1 { background: #312e81; }
.heatmap-cell.level-2 { background: #4338ca; }
.heatmap-cell.level-3 { background: #6366f1; }
.heatmap-cell.level-4 { background: #818cf8; }

.heatmap-tooltip {
  display: none;
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: #1e2030;
  color: var(--text-primary);
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 11px;
  white-space: nowrap;
  pointer-events: none;
  z-index: 10;
  border: 1px solid var(--border);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.heatmap-tooltip .tooltip-count {
  font-weight: 700;
  color: var(--accent);
}

.heatmap-cell:hover .heatmap-tooltip {
  display: block;
}

.heatmap-scale {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 8px;
  padding-left: 36px;
}

.heatmap-scale-label {
  font-size: 10px;
  color: var(--text-muted);
}

.heatmap-scale-cell {
  width: 12px;
  height: 12px;
  border-radius: 2px;
}

/* --- Item #25: Human vs Agent Activity --- */
.activity-comparison {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.activity-proportion-bar {
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
  display: flex;
  background: rgba(255,255,255,0.03);
}

.proportion-human {
  background: var(--success);
  transition: width 1s ease;
}

.proportion-agent {
  background: var(--accent);
  transition: width 1s ease;
}

.activity-proportion-labels {
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
}

.proportion-label {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.proportion-label.human-label { color: var(--success); }
.proportion-label.agent-label { color: var(--accent); }

.activity-cards {
  display: grid;
  grid-template-columns: 1fr 1px 1fr;
  gap: 0;
}

.activity-card {
  padding: 20px;
}

.activity-divider {
  background: var(--border);
  width: 1px;
}

.activity-card-total {
  font-size: 36px;
  font-weight: 700;
  line-height: 1;
  margin-bottom: 2px;
}

.activity-card.human-card .activity-card-total { color: var(--success); }
.activity-card.agent-card .activity-card-total { color: var(--accent); }

.activity-card-label {
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 16px;
}

.activity-breakdown {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.activity-breakdown-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.breakdown-label {
  font-size: 12px;
  color: var(--text-secondary);
  min-width: 100px;
  flex-shrink: 0;
}

.breakdown-bar-track {
  flex: 1;
  height: 6px;
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
  overflow: hidden;
}

.breakdown-bar-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.8s ease;
}

.human-card .breakdown-bar-fill { background: var(--success); }
.agent-card .breakdown-bar-fill { background: var(--accent); }

.breakdown-count {
  font-size: 12px;
  color: var(--text-muted);
  min-width: 24px;
  text-align: right;
  font-variant-numeric: tabular-nums;
}

.activity-subtitle {
  font-size: 11px;
  color: var(--text-muted);
  text-align: center;
  margin-top: 4px;
}

/* --- Item #19: Empty States --- */
.empty-states-showcase {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 32px 24px;
  border-radius: var(--radius);
  text-align: center;
  gap: 8px;
}

.empty-state.empty-positive {
  background: rgba(34, 197, 94, 0.04);
  border: 1px solid rgba(34, 197, 94, 0.15);
}

.empty-state.empty-neutral {
  background: rgba(99, 102, 241, 0.04);
  border: 1px solid rgba(99, 102, 241, 0.15);
}

.empty-state-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  margin-bottom: 4px;
}

.empty-positive .empty-state-icon {
  background: rgba(34, 197, 94, 0.1);
  color: var(--success);
}

.empty-neutral .empty-state-icon {
  background: rgba(99, 102, 241, 0.1);
  color: var(--accent);
}

.empty-state-title {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary);
}

.empty-state-message {
  font-size: 13px;
  color: var(--text-secondary);
  max-width: 320px;
  line-height: 1.5;
}
</style>

<div class="demo-group" id="group-2">

  <!-- ============================================================
       Item #2: Event Timeline
       ============================================================ -->
  <div class="demo-item" id="item-2">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9313;</span>
      <h3>Event Timeline</h3>
      <span class="demo-item-tag">Activity</span>
    </div>
    <div class="demo-item-body">
      <div class="event-timeline" id="event-timeline"></div>
    </div>
  </div>

  <!-- ============================================================
       Item #14: Assignee Workload Balance
       ============================================================ -->
  <div class="demo-item" id="item-14">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9325;</span>
      <h3>Assignee Workload Balance</h3>
      <span class="demo-item-tag">Distribution</span>
    </div>
    <div class="demo-item-body">
      <div class="workload-balance" id="workload-balance"></div>
    </div>
  </div>

  <!-- ============================================================
       Item #17: Activity Heatmap
       ============================================================ -->
  <div class="demo-item" id="item-17">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9328;</span>
      <h3>Activity Heatmap</h3>
      <span class="demo-item-tag">Calendar</span>
    </div>
    <div class="demo-item-body">
      <div class="heatmap-container" id="activity-heatmap"></div>
    </div>
  </div>

  <!-- ============================================================
       Item #25: Human vs Agent Activity
       ============================================================ -->
  <div class="demo-item" id="item-25">
    <div class="demo-item-header">
      <span class="demo-item-number">&#12888;</span>
      <h3>Human vs Agent Activity</h3>
      <span class="demo-item-tag">Comparison</span>
    </div>
    <div class="demo-item-body">
      <div class="activity-comparison" id="activity-comparison"></div>
    </div>
  </div>

  <!-- ============================================================
       Item #19: Empty State Design
       ============================================================ -->
  <div class="demo-item" id="item-19">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9330;</span>
      <h3>Empty State Design</h3>
      <span class="demo-item-tag">UX</span>
    </div>
    <div class="demo-item-body">
      <div class="empty-states-showcase" id="empty-states"></div>
    </div>
  </div>

</div>

<script>
/* ============================================================
   Section 2 Scripts
   ============================================================ */
(function() {
  'use strict';

  /* ----------------------------------------------------------
     #2 — Event Timeline
     ---------------------------------------------------------- */
  const timelineEvents = [
    { ago: '3h ago',  type: 'status',  task: 'LAT-47', action: 'in_progress',                                      actor: 'agent:claude-opus-4' },
    { ago: '5h ago',  type: 'status',  task: 'LAT-45', action: 'review',                                           actor: 'human:atin' },
    { ago: '6h ago',  type: 'create',  task: 'LAT-46', action: 'created',                                          actor: 'human:atin' },
    { ago: '8h ago',  type: 'comment', task: 'LAT-45', action: 'comment', comment: 'All tests passing, ready for review', actor: 'agent:claude-opus-4' },
    { ago: '12h ago', type: 'done',    task: 'LAT-40', action: 'done',                                             actor: 'agent:codex' },
    { ago: '18h ago', type: 'assign',  task: 'LAT-44', action: 'assigned to agent:claude-opus-4',                  actor: 'human:atin' },
  ];

  function dotClass(type) {
    switch (type) {
      case 'done':    return 'dot-done';
      case 'status':  return 'dot-status';
      case 'comment': return 'dot-comment';
      case 'create':  return 'dot-create';
      case 'assign':  return 'dot-status';
      default:        return 'dot-status';
    }
  }

  function actorPill(actor) {
    const isAgent = actor.startsWith('agent:');
    const cls = isAgent ? 'actor-agent' : 'actor-human';
    return `<span class="actor-pill ${cls}">${actor}</span>`;
  }

  function renderAction(ev) {
    const ref = `<span class="task-ref">${ev.task}</span>`;
    switch (ev.type) {
      case 'status':
        return `${ref} <span class="status-label">\u2192 ${ev.action}</span>`;
      case 'done':
        return `${ref} <span class="status-label">\u2192 done</span>`;
      case 'create':
        return `${ref} created`;
      case 'comment':
        return `${ref} comment: <span class="comment-text">"${ev.comment}"</span>`;
      case 'assign':
        return `${ref} ${ev.action}`;
      default:
        return `${ref} ${ev.action}`;
    }
  }

  const timelineEl = document.getElementById('event-timeline');
  timelineEvents.forEach(ev => {
    timelineEl.insertAdjacentHTML('beforeend', `
      <div class="timeline-event">
        <span class="timeline-dot ${dotClass(ev.type)}"></span>
        <span class="timeline-time">${ev.ago}</span>
        <div class="timeline-content">
          <span class="timeline-action">${renderAction(ev)}</span>
          ${actorPill(ev.actor)}
        </div>
      </div>
    `);
  });


  /* ----------------------------------------------------------
     #14 — Assignee Workload Balance
     ---------------------------------------------------------- */
  const workloadData = [
    { assignee: 'human:atin',           total: 12, segments: { backlog: 2, planned: 3, in_progress: 3, review: 2, done: 2 } },
    { assignee: 'agent:claude-opus-4',  total: 8,  segments: { in_progress: 2, review: 1, done: 4, blocked: 1 } },
    { assignee: 'agent:codex',          total: 5,  segments: { planned: 2, in_progress: 1, done: 2 } },
    { assignee: 'unassigned',           total: 7,  segments: { backlog: 2, planned: 1, in_progress: 1, blocked: 2, in_planning: 1 } },
  ];

  const statusColors = {
    backlog: '#475569', in_planning: '#7c3aed', planned: '#6366f1',
    in_progress: '#3b82f6', review: '#f59e0b', done: '#22c55e', blocked: '#ef4444',
  };

  const statusLabels = {
    backlog: 'Backlog', in_planning: 'In Planning', planned: 'Planned',
    in_progress: 'In Progress', review: 'Review', done: 'Done', blocked: 'Blocked',
  };

  const maxTotal = Math.max(...workloadData.map(d => d.total));
  const workloadEl = document.getElementById('workload-balance');

  workloadData.forEach(row => {
    const isUnassigned = row.assignee === 'unassigned';
    const barWidth = (row.total / maxTotal) * 100;
    let segmentsHTML = '';

    const orderedStatuses = ['backlog', 'in_planning', 'planned', 'in_progress', 'review', 'done', 'blocked'];
    orderedStatuses.forEach(status => {
      const count = row.segments[status];
      if (!count) return;
      const pct = (count / row.total) * 100;
      segmentsHTML += `
        <div class="workload-segment" data-status="${status}" style="width: ${pct}%;">
          <span class="workload-segment-tooltip">${statusLabels[status]}: ${count}</span>
          ${count >= 2 ? count : ''}
        </div>`;
    });

    workloadEl.insertAdjacentHTML('beforeend', `
      <div class="workload-row ${isUnassigned ? 'unassigned-row' : ''}">
        <div class="workload-label-row">
          <span class="workload-assignee">${row.assignee}</span>
          <span class="workload-total">${row.total} tasks</span>
        </div>
        <div class="workload-bar-track" style="width: ${barWidth}%;">
          ${segmentsHTML}
        </div>
      </div>
    `);
  });

  // Legend
  const legendItems = orderedStatusesForLegend();
  function orderedStatusesForLegend() {
    const all = new Set();
    workloadData.forEach(r => Object.keys(r.segments).forEach(s => all.add(s)));
    return ['backlog','in_planning','planned','in_progress','review','done','blocked'].filter(s => all.has(s));
  }
  let legendHTML = '<div class="workload-legend">';
  legendItems.forEach(s => {
    legendHTML += `<span class="workload-legend-item"><span class="workload-legend-swatch" style="background:${statusColors[s]}"></span>${statusLabels[s]}</span>`;
  });
  legendHTML += '</div>';
  workloadEl.insertAdjacentHTML('beforeend', legendHTML);


  /* ----------------------------------------------------------
     #17 — Activity Heatmap (GitHub style)
     ---------------------------------------------------------- */
  function buildHeatmapData() {
    const data = [];
    const today = new Date();
    // Go back ~91 days so we fill 13 complete weeks
    const start = new Date(today);
    start.setDate(start.getDate() - 90);
    // Align start to the previous Sunday
    start.setDate(start.getDate() - start.getDay());

    const d = new Date(start);
    while (d <= today) {
      const dayOfWeek = d.getDay();
      const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
      let count;
      const rand = Math.random();
      if (isWeekend) {
        count = rand < 0.5 ? 0 : rand < 0.85 ? Math.floor(Math.random() * 2) + 1 : Math.floor(Math.random() * 3) + 1;
      } else {
        if (rand < 0.08) count = Math.floor(Math.random() * 5) + 8; // spike
        else if (rand < 0.15) count = 0;
        else count = Math.floor(Math.random() * 5) + 1;
      }
      data.push({ date: new Date(d), count });
      d.setDate(d.getDate() + 1);
    }
    return data;
  }

  function heatLevel(count) {
    if (count === 0) return 'level-0';
    if (count <= 2) return 'level-1';
    if (count <= 5) return 'level-2';
    if (count <= 8) return 'level-3';
    return 'level-4';
  }

  const heatData = buildHeatmapData();
  const heatmapEl = document.getElementById('activity-heatmap');

  // Organize into weeks (columns)
  const weeks = [];
  let currentWeek = [];
  heatData.forEach((d, i) => {
    currentWeek.push(d);
    if (currentWeek.length === 7) {
      weeks.push(currentWeek);
      currentWeek = [];
    }
  });
  if (currentWeek.length > 0) {
    // Pad the last incomplete week
    while (currentWeek.length < 7) currentWeek.push(null);
    weeks.push(currentWeek);
  }

  // Month labels
  const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  let monthLabelsHTML = '<div class="heatmap-month-labels">';
  let lastMonth = -1;
  weeks.forEach((week, wi) => {
    const firstDay = week.find(d => d !== null);
    if (firstDay) {
      const m = firstDay.date.getMonth();
      if (m !== lastMonth) {
        monthLabelsHTML += `<span class="heatmap-month-label" style="width: ${17}px; flex-shrink: 0;">${monthNames[m]}</span>`;
        lastMonth = m;
      } else {
        monthLabelsHTML += `<span style="width: 17px; flex-shrink: 0;"></span>`;
      }
    }
  });
  monthLabelsHTML += '</div>';

  // Day labels (Mon, Wed, Fri)
  const dayLabels = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  let dayLabelsHTML = '<div class="heatmap-day-labels">';
  for (let i = 0; i < 7; i++) {
    const show = (i === 1 || i === 3 || i === 5);
    dayLabelsHTML += `<span class="heatmap-day-label">${show ? dayLabels[i] : ''}</span>`;
  }
  dayLabelsHTML += '</div>';

  // Grid
  let gridHTML = '<div class="heatmap-grid">';
  weeks.forEach(week => {
    gridHTML += '<div class="heatmap-column">';
    week.forEach(day => {
      if (!day) {
        gridHTML += '<div class="heatmap-cell level-0"></div>';
        return;
      }
      const dateStr = day.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      const evtWord = day.count === 1 ? 'event' : 'events';
      gridHTML += `<div class="heatmap-cell ${heatLevel(day.count)}">
        <span class="heatmap-tooltip"><span class="tooltip-count">${day.count}</span> ${evtWord} on ${dateStr}</span>
      </div>`;
    });
    gridHTML += '</div>';
  });
  gridHTML += '</div>';

  // Scale legend
  let scaleHTML = '<div class="heatmap-scale">';
  scaleHTML += '<span class="heatmap-scale-label">Less</span>';
  ['level-0','level-1','level-2','level-3','level-4'].forEach(l => {
    scaleHTML += `<span class="heatmap-scale-cell heatmap-cell ${l}"></span>`;
  });
  scaleHTML += '<span class="heatmap-scale-label">More</span>';
  scaleHTML += '</div>';

  heatmapEl.innerHTML = monthLabelsHTML +
    '<div class="heatmap-grid-wrapper">' + dayLabelsHTML + gridHTML + '</div>' +
    scaleHTML;


  /* ----------------------------------------------------------
     #25 — Human vs Agent Activity Metrics
     ---------------------------------------------------------- */
  const humanData = { total: 45, statusChanges: 28, comments: 12, creates: 5 };
  const agentData = { total: 90, statusChanges: 46, comments: 27, creates: 17 };
  const grandTotal = humanData.total + agentData.total;
  const humanPct = Math.round((humanData.total / grandTotal) * 100);
  const agentPct = 100 - humanPct;
  const maxBreakdown = Math.max(humanData.statusChanges, agentData.statusChanges, humanData.comments, agentData.comments, humanData.creates, agentData.creates);

  function breakdownRow(label, count, maxVal) {
    const pct = (count / maxVal) * 100;
    return `
      <div class="activity-breakdown-row">
        <span class="breakdown-label">${label}</span>
        <div class="breakdown-bar-track">
          <div class="breakdown-bar-fill" style="width: ${pct}%;"></div>
        </div>
        <span class="breakdown-count">${count}</span>
      </div>`;
  }

  const compEl = document.getElementById('activity-comparison');
  compEl.innerHTML = `
    <div class="activity-proportion-labels">
      <span class="proportion-label human-label">Human Activity (${humanPct}%)</span>
      <span class="proportion-label agent-label">Agent Activity (${agentPct}%)</span>
    </div>
    <div class="activity-proportion-bar">
      <div class="proportion-human" style="width: ${humanPct}%;"></div>
      <div class="proportion-agent" style="width: ${agentPct}%;"></div>
    </div>
    <div class="activity-cards">
      <div class="activity-card human-card">
        <div class="activity-card-total">${humanData.total}</div>
        <div class="activity-card-label">events</div>
        <div class="activity-breakdown">
          ${breakdownRow('Status changes', humanData.statusChanges, maxBreakdown)}
          ${breakdownRow('Comments', humanData.comments, maxBreakdown)}
          ${breakdownRow('Creates', humanData.creates, maxBreakdown)}
        </div>
      </div>
      <div class="activity-divider"></div>
      <div class="activity-card agent-card">
        <div class="activity-card-total">${agentData.total}</div>
        <div class="activity-card-label">events</div>
        <div class="activity-breakdown">
          ${breakdownRow('Status changes', agentData.statusChanges, maxBreakdown)}
          ${breakdownRow('Comments', agentData.comments, maxBreakdown)}
          ${breakdownRow('Creates', agentData.creates, maxBreakdown)}
        </div>
      </div>
    </div>
    <div class="activity-subtitle">Last 30 days</div>
  `;


  /* ----------------------------------------------------------
     #19 — Empty State Design
     ---------------------------------------------------------- */
  const emptyStatesEl = document.getElementById('empty-states');
  emptyStatesEl.innerHTML = `
    <div class="empty-state empty-positive">
      <div class="empty-state-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <div class="empty-state-title">No Stale Tasks</div>
      <div class="empty-state-message">Everything is moving \u2014 no tasks idle for 7+ days. Your team is keeping things fresh.</div>
    </div>
    <div class="empty-state empty-neutral">
      <div class="empty-state-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
          <path d="M9 12l2 2 4-4"></path>
        </svg>
      </div>
      <div class="empty-state-title">No Blocked Tasks</div>
      <div class="empty-state-message">All clear \u2014 nothing is waiting on dependencies or external input right now.</div>
    </div>
  `;

})();
</script>
<div class="section-divider">Section 3 &mdash; Charts &amp; Visualization</div>
<!-- Section 3: Charts & Visualization (items 4, 5, 8, 16, 27) -->
<style>
  /* ── Section 3 Scoped Styles ── */
  #group-3 .sparkline-card {
    display: flex;
    align-items: center;
    gap: 16px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px 20px;
    transition: background 0.2s;
  }
  #group-3 .sparkline-card:hover {
    background: var(--bg-card-hover);
  }
  #group-3 .sparkline-label {
    min-width: 140px;
  }
  #group-3 .sparkline-label .spark-title {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 4px;
  }
  #group-3 .sparkline-label .spark-value {
    font-size: 22px;
    font-weight: 700;
    color: var(--text-primary);
  }
  #group-3 .sparkline-label .spark-value .spark-unit {
    font-size: 13px;
    font-weight: 400;
    color: var(--text-muted);
    margin-left: 2px;
  }
  #group-3 .sparkline-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 8px;
  }

  /* Cumulative Flow */
  #group-3 .cfd-container {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
  }
  #group-3 .cfd-container svg {
    width: 100%;
    height: 250px;
    display: block;
  }
  #group-3 .cfd-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
  }
  #group-3 .cfd-legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--text-secondary);
  }
  #group-3 .cfd-legend-item .cfd-swatch {
    width: 12px;
    height: 12px;
    border-radius: 3px;
    flex-shrink: 0;
  }

  /* Donut Chart */
  #group-3 .donut-layout {
    display: flex;
    align-items: center;
    gap: 40px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
  }
  #group-3 .donut-svg-wrap {
    flex-shrink: 0;
    position: relative;
  }
  #group-3 .donut-svg-wrap svg {
    display: block;
  }
  #group-3 .donut-legend {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  #group-3 .donut-legend-row {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
    color: var(--text-secondary);
    padding: 4px 8px;
    border-radius: 6px;
    transition: background 0.15s;
  }
  #group-3 .donut-legend-row:hover {
    background: var(--bg-card-hover);
  }
  #group-3 .donut-legend-row .dl-swatch {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  #group-3 .donut-legend-row .dl-name {
    flex: 1;
    color: var(--text-primary);
    font-weight: 500;
  }
  #group-3 .donut-legend-row .dl-count {
    font-variant-numeric: tabular-nums;
    color: var(--text-primary);
    font-weight: 600;
    min-width: 20px;
    text-align: right;
  }
  #group-3 .donut-legend-row .dl-pct {
    font-variant-numeric: tabular-nums;
    color: var(--text-muted);
    min-width: 40px;
    text-align: right;
  }
  #group-3 .donut-tooltip {
    position: fixed;
    pointer-events: none;
    background: #0f1117ee;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 12px;
    color: var(--text-primary);
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.15s;
    white-space: nowrap;
  }
  #group-3 .donut-tooltip.visible {
    opacity: 1;
  }

  /* Burndown / Completion Rate */
  #group-3 .burndown-container {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
  }
  #group-3 .burndown-container svg {
    width: 100%;
    height: 220px;
    display: block;
  }
  #group-3 .burndown-legend {
    display: flex;
    gap: 20px;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--border);
    font-size: 12px;
    color: var(--text-secondary);
  }
  #group-3 .burndown-legend span {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  #group-3 .burndown-legend .bl-line {
    width: 20px;
    height: 2px;
    border-radius: 1px;
  }

  /* Baseline / Goal bars */
  #group-3 .baseline-container {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
  }
  #group-3 .baseline-container svg {
    width: 100%;
    height: 200px;
    display: block;
  }
  #group-3 .baseline-legend {
    display: flex;
    gap: 20px;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--border);
    font-size: 12px;
    color: var(--text-secondary);
  }
  #group-3 .baseline-legend span {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  /* Donut animation */
  @keyframes donut-draw {
    from { stroke-dashoffset: var(--circumference); }
    to   { stroke-dashoffset: var(--final-offset); }
  }
</style>

<div class="demo-group" id="group-3">
  <h2 class="demo-group-title">Section 3 &mdash; Charts &amp; Visualization</h2>

  <!-- ====== Item 4: Velocity Sparklines ====== -->
  <div class="demo-item" id="item-4">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9315;</span>
      <h3>Velocity Sparklines</h3>
      <span class="demo-item-tag">Charts</span>
    </div>
    <div class="demo-item-body">
      <div class="sparkline-row">
        <!-- Velocity Card -->
        <div class="sparkline-card">
          <div class="sparkline-label">
            <div class="spark-title">Velocity</div>
            <div class="spark-value">3<span class="spark-unit">/wk</span></div>
          </div>
          <svg id="spark-velocity" width="200" height="40" viewBox="0 0 200 40"></svg>
        </div>
        <!-- Throughput Card -->
        <div class="sparkline-card">
          <div class="sparkline-label">
            <div class="spark-title">Throughput</div>
            <div class="spark-value">26<span class="spark-unit"> created</span> / 23<span class="spark-unit"> done</span></div>
          </div>
          <svg id="spark-throughput" width="200" height="40" viewBox="0 0 200 40"></svg>
        </div>
      </div>
    </div>
  </div>

  <!-- ====== Item 5: Cumulative Flow Diagram ====== -->
  <div class="demo-item" id="item-5">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9316;</span>
      <h3>Cumulative Flow Diagram</h3>
      <span class="demo-item-tag">Charts</span>
    </div>
    <div class="demo-item-body">
      <div class="cfd-container">
        <svg id="cfd-chart" viewBox="0 0 700 250" preserveAspectRatio="xMidYMid meet"></svg>
        <div class="cfd-legend" id="cfd-legend"></div>
      </div>
    </div>
  </div>

  <!-- ====== Item 8: Donut Chart ====== -->
  <div class="demo-item" id="item-8">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9319;</span>
      <h3>Status Distribution Donut</h3>
      <span class="demo-item-tag">Charts</span>
    </div>
    <div class="demo-item-body">
      <div class="donut-layout">
        <div class="donut-svg-wrap">
          <svg id="donut-chart" width="200" height="200" viewBox="0 0 200 200"></svg>
        </div>
        <div class="donut-legend" id="donut-legend"></div>
      </div>
      <div class="donut-tooltip" id="donut-tooltip"></div>
    </div>
  </div>

  <!-- ====== Item 16: Completion Rate / Burndown ====== -->
  <div class="demo-item" id="item-16">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9327;</span>
      <h3>Completion Rate / Burndown</h3>
      <span class="demo-item-tag">Charts</span>
    </div>
    <div class="demo-item-body">
      <div class="burndown-container">
        <svg id="burndown-chart" viewBox="0 0 600 220" preserveAspectRatio="xMidYMid meet"></svg>
        <div class="burndown-legend">
          <span><span class="bl-line" style="background:#3b82f6;border-top:2px dashed #3b82f6;height:0"></span> Created (cumulative)</span>
          <span><span class="bl-line" style="background:#22c55e"></span> Completed (cumulative)</span>
          <span><span class="bl-line" style="background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);width:16px;height:10px;border-radius:2px"></span> Open backlog gap</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ====== Item 27: Baseline/Goal Lines ====== -->
  <div class="demo-item" id="item-27">
    <div class="demo-item-header">
      <span class="demo-item-number">&#12887;</span>
      <h3>Baseline / Goal Lines</h3>
      <span class="demo-item-tag">Charts</span>
    </div>
    <div class="demo-item-body">
      <div class="baseline-container">
        <svg id="baseline-chart" viewBox="0 0 600 200" preserveAspectRatio="xMidYMid meet"></svg>
        <div class="baseline-legend">
          <span><span style="display:inline-block;width:16px;height:10px;border-radius:2px;background:#22c55e"></span> At or above target</span>
          <span><span style="display:inline-block;width:16px;height:10px;border-radius:2px;background:#f59e0b"></span> Below target</span>
          <span><span style="display:inline-block;width:20px;height:0;border-top:2px dashed rgba(255,255,255,0.5)"></span> Target velocity (4/wk)</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  "use strict";

  /* ─── Helpers ─── */
  const SVG_NS = "http://www.w3.org/2000/svg";
  function svgEl(tag, attrs, parent) {
    const el = document.createElementNS(SVG_NS, tag);
    for (const [k, v] of Object.entries(attrs || {})) el.setAttribute(k, v);
    if (parent) parent.appendChild(el);
    return el;
  }

  /* ================================================================
     ④  Velocity Sparklines
     ================================================================ */
  function drawSparkline(svgId, datasets) {
    const svg = document.getElementById(svgId);
    if (!svg) return;
    const W = 200, H = 40, padX = 4, padY = 4;

    // subtle grid
    for (let y = padY; y <= H - padY; y += (H - 2 * padY) / 4) {
      svgEl("line", { x1: padX, y1: y, x2: W - padX, y2: y,
        stroke: "rgba(255,255,255,0.04)", "stroke-width": 0.5 }, svg);
    }

    const allVals = datasets.flatMap(d => d.data);
    const maxVal = Math.max(...allVals, 1);

    datasets.forEach(function(ds) {
      const pts = ds.data.map(function(v, i) {
        const x = padX + (i / (ds.data.length - 1)) * (W - 2 * padX);
        const y = H - padY - (v / maxVal) * (H - 2 * padY);
        return [x, y];
      });

      // fill area
      const areaPath = "M" + pts.map(p => p.join(",")).join("L") +
        "L" + pts[pts.length - 1][0] + "," + (H - padY) +
        "L" + pts[0][0] + "," + (H - padY) + "Z";
      svgEl("path", { d: areaPath, fill: ds.color, opacity: "0.1" }, svg);

      // line
      svgEl("polyline", {
        points: pts.map(p => p.join(",")).join(" "),
        fill: "none", stroke: ds.color, "stroke-width": 1.5,
        "stroke-linecap": "round", "stroke-linejoin": "round"
      }, svg);

      // end dot
      const last = pts[pts.length - 1];
      svgEl("circle", { cx: last[0], cy: last[1], r: 2.5, fill: ds.color }, svg);

      // end label
      svgEl("text", {
        x: last[0] - 8, y: last[1] - 6,
        fill: ds.color, "font-size": "9", "font-weight": "600",
        "font-family": "Inter, system-ui, sans-serif"
      }, svg).textContent = ds.data[ds.data.length - 1];
    });
  }

  const completedPerWeek = [2, 3, 1, 4, 2, 5, 3, 3];
  const createdPerWeek = [3, 2, 4, 3, 5, 2, 4, 3];

  drawSparkline("spark-velocity", [
    { data: completedPerWeek, color: "#22c55e" }
  ]);
  drawSparkline("spark-throughput", [
    { data: createdPerWeek, color: "#3b82f6" },
    { data: completedPerWeek, color: "#22c55e" }
  ]);


  /* ================================================================
     ⑤  Cumulative Flow Diagram
     ================================================================ */
  (function drawCFD() {
    const svg = document.getElementById("cfd-chart");
    if (!svg) return;

    const rawData = {
      done:        [2,  4,  5,  7,  8, 10, 12, 14, 16, 18, 20, 23],
      review:      [1,  2,  2,  1,  3,  2,  2,  3,  2,  3,  3,  3],
      in_progress: [3,  3,  4,  4,  3,  4,  5,  4,  5,  5,  5,  5],
      planned:     [4,  5,  5,  6,  7,  6,  5,  6,  7,  6,  6,  6],
      in_planning: [2,  2,  3,  2,  2,  2,  1,  2,  2,  2,  2,  2],
      backlog:     [5,  5,  4,  5,  5,  6,  5,  4,  4,  4,  4,  4]
    };

    const statusOrder = ["done", "review", "in_progress", "planned", "in_planning", "backlog"];
    const statusColors = {
      done: "#22c55e", review: "#f59e0b", in_progress: "#3b82f6",
      planned: "#818cf8", in_planning: "#a78bfa", backlog: "#64748b"
    };
    const statusLabels = {
      done: "Done", review: "Review", in_progress: "In Progress",
      planned: "Planned", in_planning: "In Planning", backlog: "Backlog"
    };

    const weeks = 12;
    const W = 700, H = 250;
    const padL = 40, padR = 16, padT = 16, padB = 30;
    const chartW = W - padL - padR;
    const chartH = H - padT - padB;

    // Compute cumulative stacks: each status stacks on top of the previous
    const stacks = {};
    let cumulative = new Array(weeks).fill(0);
    statusOrder.forEach(function(s) {
      const bottom = cumulative.slice();
      const top = cumulative.map(function(c, i) { return c + rawData[s][i]; });
      stacks[s] = { bottom: bottom, top: top };
      cumulative = top;
    });

    const maxY = Math.max(...cumulative);

    function xPos(i) { return padL + (i / (weeks - 1)) * chartW; }
    function yPos(v) { return padT + chartH - (v / maxY) * chartH; }

    // Grid lines
    const gridSteps = 5;
    for (let g = 0; g <= gridSteps; g++) {
      const val = Math.round((maxY / gridSteps) * g);
      const y = yPos(val);
      svgEl("line", {
        x1: padL, y1: y, x2: W - padR, y2: y,
        stroke: "rgba(255,255,255,0.05)", "stroke-width": 0.5
      }, svg);
      svgEl("text", {
        x: padL - 6, y: y + 3, fill: "#64748b",
        "font-size": "10", "text-anchor": "end",
        "font-family": "Inter, system-ui, sans-serif"
      }, svg).textContent = val;
    }

    // X axis labels
    for (let i = 0; i < weeks; i++) {
      svgEl("text", {
        x: xPos(i), y: H - 6, fill: "#64748b",
        "font-size": "10", "text-anchor": "middle",
        "font-family": "Inter, system-ui, sans-serif"
      }, svg).textContent = "W" + (i + 1);
    }

    // Build smooth bezier paths for each stacked area
    function bezierPoints(pts) {
      if (pts.length < 2) return "";
      let d = "M" + pts[0][0] + "," + pts[0][1];
      for (let i = 0; i < pts.length - 1; i++) {
        const cx = (pts[i][0] + pts[i + 1][0]) / 2;
        d += "C" + cx + "," + pts[i][1] + " " + cx + "," + pts[i + 1][1] + " " + pts[i + 1][0] + "," + pts[i + 1][1];
      }
      return d;
    }

    // Draw from top to bottom so top layers draw over bottom
    for (let si = statusOrder.length - 1; si >= 0; si--) {
      const s = statusOrder[si];
      const st = stacks[s];
      const topPts = [];
      const botPts = [];
      for (let i = 0; i < weeks; i++) {
        topPts.push([xPos(i), yPos(st.top[i])]);
        botPts.push([xPos(i), yPos(st.bottom[i])]);
      }

      const topPath = bezierPoints(topPts);
      const botReversed = botPts.slice().reverse();
      const botPath = bezierPoints(botReversed).replace("M", "L");

      svgEl("path", {
        d: topPath + botPath + "Z",
        fill: statusColors[s],
        opacity: "0.7"
      }, svg);

      // Top border line
      svgEl("path", {
        d: topPath, fill: "none",
        stroke: statusColors[s], "stroke-width": 1.5, opacity: "0.9"
      }, svg);
    }

    // Legend
    const legendEl = document.getElementById("cfd-legend");
    statusOrder.slice().reverse().forEach(function(s) {
      const item = document.createElement("div");
      item.className = "cfd-legend-item";
      item.innerHTML = '<span class="cfd-swatch" style="background:' + statusColors[s] + '"></span>' + statusLabels[s];
      legendEl.appendChild(item);
    });
  })();


  /* ================================================================
     ⑧  Donut Chart
     ================================================================ */
  (function drawDonut() {
    const svg = document.getElementById("donut-chart");
    const legendEl = document.getElementById("donut-legend");
    const tooltip = document.getElementById("donut-tooltip");
    if (!svg) return;

    const segments = [
      { name: "backlog",     count: 4, color: "#64748b" },
      { name: "in_planning", count: 2, color: "#a78bfa" },
      { name: "planned",     count: 6, color: "#818cf8" },
      { name: "in_progress", count: 5, color: "#3b82f6" },
      { name: "review",      count: 3, color: "#f59e0b" },
      { name: "done",        count: 8, color: "#22c55e" },
      { name: "blocked",     count: 3, color: "#ef4444" },
      { name: "cancelled",   count: 1, color: "#6b7280" }
    ];

    const total = segments.reduce(function(s, d) { return s + d.count; }, 0);
    const cx = 100, cy = 100, outerR = 85, innerR = 55;
    const circumference = 2 * Math.PI * ((outerR + innerR) / 2);
    const gapAngle = 0.012; // small gap between segments in radians

    // Center text
    svgEl("text", {
      x: cx, y: cy - 4, fill: "#e2e8f0",
      "font-size": "28", "font-weight": "700", "text-anchor": "middle",
      "font-family": "Inter, system-ui, sans-serif"
    }, svg).textContent = total;
    svgEl("text", {
      x: cx, y: cy + 14, fill: "#64748b",
      "font-size": "11", "text-anchor": "middle",
      "font-family": "Inter, system-ui, sans-serif"
    }, svg).textContent = "active";

    let currentAngle = -Math.PI / 2;

    segments.forEach(function(seg, idx) {
      const segAngle = (seg.count / total) * 2 * Math.PI;
      const startAngle = currentAngle + gapAngle / 2;
      const endAngle = currentAngle + segAngle - gapAngle / 2;
      currentAngle += segAngle;

      function arcPoint(angle, r) {
        return [cx + r * Math.cos(angle), cy + r * Math.sin(angle)];
      }

      const outerStart = arcPoint(startAngle, outerR);
      const outerEnd = arcPoint(endAngle, outerR);
      const innerStart = arcPoint(endAngle, innerR);
      const innerEnd = arcPoint(startAngle, innerR);
      const largeArc = segAngle - gapAngle > Math.PI ? 1 : 0;

      const d = [
        "M", outerStart[0], outerStart[1],
        "A", outerR, outerR, 0, largeArc, 1, outerEnd[0], outerEnd[1],
        "L", innerStart[0], innerStart[1],
        "A", innerR, innerR, 0, largeArc, 0, innerEnd[0], innerEnd[1],
        "Z"
      ].join(" ");

      const midAngle = startAngle + (endAngle - startAngle) / 2;
      const path = svgEl("path", {
        d: d,
        fill: seg.color,
        style: "cursor:pointer;transition:transform 0.15s ease;transform-origin:" + cx + "px " + cy + "px",
        opacity: "0"
      }, svg);

      // Animate in
      var delay = idx * 80;
      setTimeout(function() {
        path.style.transition = "opacity 0.4s ease, transform 0.15s ease";
        path.setAttribute("opacity", "1");
      }, delay);

      // Hover expand
      var expandX = Math.cos(midAngle) * 4;
      var expandY = Math.sin(midAngle) * 4;
      path.addEventListener("mouseenter", function(e) {
        path.style.transform = "translate(" + expandX + "px," + expandY + "px)";
        path.setAttribute("opacity", "0.9");
        tooltip.className = "donut-tooltip visible";
        var pct = ((seg.count / total) * 100).toFixed(1);
        tooltip.innerHTML = '<strong style="color:' + seg.color + '">' + seg.name.replace("_", " ") + '</strong>: ' + seg.count + ' (' + pct + '%)';
      });
      path.addEventListener("mousemove", function(e) {
        tooltip.style.left = (e.clientX + 12) + "px";
        tooltip.style.top = (e.clientY - 10) + "px";
      });
      path.addEventListener("mouseleave", function() {
        path.style.transform = "translate(0,0)";
        path.setAttribute("opacity", "1");
        tooltip.className = "donut-tooltip";
      });
    });

    // Legend
    segments.forEach(function(seg) {
      var pct = ((seg.count / total) * 100).toFixed(1);
      var row = document.createElement("div");
      row.className = "donut-legend-row";
      row.innerHTML =
        '<span class="dl-swatch" style="background:' + seg.color + '"></span>' +
        '<span class="dl-name">' + seg.name.replace("_", " ") + '</span>' +
        '<span class="dl-count">' + seg.count + '</span>' +
        '<span class="dl-pct">' + pct + '%</span>';
      legendEl.appendChild(row);
    });
  })();


  /* ================================================================
     ⑯  Completion Rate / Burndown
     ================================================================ */
  (function drawBurndown() {
    const svg = document.getElementById("burndown-chart");
    if (!svg) return;

    const created    = [3, 5, 9, 12, 17, 19, 23, 26];
    const completed  = [2, 5, 6, 10, 12, 17, 20, 23];
    const weeks = 8;
    const W = 600, H = 220;
    const padL = 40, padR = 60, padT = 16, padB = 28;
    const chartW = W - padL - padR;
    const chartH = H - padT - padB;
    const maxY = 30;

    function xPos(i) { return padL + (i / (weeks - 1)) * chartW; }
    function yPos(v) { return padT + chartH - (v / maxY) * chartH; }

    // Grid
    for (let g = 0; g <= 6; g++) {
      const val = g * 5;
      const y = yPos(val);
      svgEl("line", {
        x1: padL, y1: y, x2: W - padR, y2: y,
        stroke: "rgba(255,255,255,0.05)", "stroke-width": 0.5
      }, svg);
      svgEl("text", {
        x: padL - 6, y: y + 3, fill: "#64748b",
        "font-size": "10", "text-anchor": "end",
        "font-family": "Inter, system-ui, sans-serif"
      }, svg).textContent = val;
    }

    // X axis
    for (let i = 0; i < weeks; i++) {
      svgEl("text", {
        x: xPos(i), y: H - 4, fill: "#64748b",
        "font-size": "10", "text-anchor": "middle",
        "font-family": "Inter, system-ui, sans-serif"
      }, svg).textContent = "W" + (i + 1);
    }

    // Gap fill (area between created and completed)
    var gapPath = "M" + xPos(0) + "," + yPos(created[0]);
    for (var i = 1; i < weeks; i++) gapPath += "L" + xPos(i) + "," + yPos(created[i]);
    for (var i = weeks - 1; i >= 0; i--) gapPath += "L" + xPos(i) + "," + yPos(completed[i]);
    gapPath += "Z";
    svgEl("path", {
      d: gapPath,
      fill: "rgba(239,68,68,0.08)",
      stroke: "rgba(239,68,68,0.15)",
      "stroke-width": 0.5
    }, svg);

    // Created line (dashed blue)
    function makePath(data) {
      return data.map(function(v, i) { return (i === 0 ? "M" : "L") + xPos(i) + "," + yPos(v); }).join("");
    }

    svgEl("path", {
      d: makePath(created),
      fill: "none", stroke: "#3b82f6", "stroke-width": 2,
      "stroke-dasharray": "6,4",
      "stroke-linecap": "round"
    }, svg);

    // Completed line (solid green)
    svgEl("path", {
      d: makePath(completed),
      fill: "none", stroke: "#22c55e", "stroke-width": 2,
      "stroke-linecap": "round", "stroke-linejoin": "round"
    }, svg);

    // Dots
    created.forEach(function(v, i) {
      svgEl("circle", { cx: xPos(i), cy: yPos(v), r: 3, fill: "#0f1117", stroke: "#3b82f6", "stroke-width": 1.5 }, svg);
    });
    completed.forEach(function(v, i) {
      svgEl("circle", { cx: xPos(i), cy: yPos(v), r: 3, fill: "#0f1117", stroke: "#22c55e", "stroke-width": 1.5 }, svg);
    });

    // End labels
    svgEl("text", {
      x: xPos(7) + 8, y: yPos(26) + 4, fill: "#3b82f6",
      "font-size": "11", "font-weight": "600",
      "font-family": "Inter, system-ui, sans-serif"
    }, svg).textContent = "26";
    svgEl("text", {
      x: xPos(7) + 8, y: yPos(23) + 4, fill: "#22c55e",
      "font-size": "11", "font-weight": "600",
      "font-family": "Inter, system-ui, sans-serif"
    }, svg).textContent = "23";

    // Net open label
    var midY = (yPos(26) + yPos(23)) / 2;
    svgEl("text", {
      x: xPos(7) + 28, y: midY + 3, fill: "#ef4444",
      "font-size": "10", "font-weight": "500",
      "font-family": "Inter, system-ui, sans-serif"
    }, svg).textContent = "3 net open";

    // Bracket line for gap
    var bracketX = xPos(7) + 24;
    svgEl("line", {
      x1: bracketX, y1: yPos(26), x2: bracketX, y2: yPos(23),
      stroke: "rgba(239,68,68,0.5)", "stroke-width": 1
    }, svg);
    svgEl("line", {
      x1: bracketX - 3, y1: yPos(26), x2: bracketX + 3, y2: yPos(26),
      stroke: "rgba(239,68,68,0.5)", "stroke-width": 1
    }, svg);
    svgEl("line", {
      x1: bracketX - 3, y1: yPos(23), x2: bracketX + 3, y2: yPos(23),
      stroke: "rgba(239,68,68,0.5)", "stroke-width": 1
    }, svg);
  })();


  /* ================================================================
     ㉗  Baseline / Goal Lines (bar chart with target overlay)
     ================================================================ */
  (function drawBaseline() {
    const svg = document.getElementById("baseline-chart");
    if (!svg) return;

    const velocity = [2, 3, 1, 4, 2, 5, 3, 3];
    const target = 4;
    const weeks = 8;
    const W = 600, H = 200;
    const padL = 40, padR = 20, padT = 20, padB = 28;
    const chartW = W - padL - padR;
    const chartH = H - padT - padB;
    const maxY = 6;

    function yPos(v) { return padT + chartH - (v / maxY) * chartH; }

    // Grid
    for (let g = 0; g <= maxY; g++) {
      const y = yPos(g);
      svgEl("line", {
        x1: padL, y1: y, x2: W - padR, y2: y,
        stroke: "rgba(255,255,255,0.04)", "stroke-width": 0.5
      }, svg);
      svgEl("text", {
        x: padL - 6, y: y + 3, fill: "#64748b",
        "font-size": "10", "text-anchor": "end",
        "font-family": "Inter, system-ui, sans-serif"
      }, svg).textContent = g;
    }

    // Bars
    const barGap = 12;
    const totalBarSpace = chartW / weeks;
    const barW = totalBarSpace - barGap;

    velocity.forEach(function(v, i) {
      const x = padL + i * totalBarSpace + barGap / 2;
      const barH = (v / maxY) * chartH;
      const y = padT + chartH - barH;
      const color = v >= target ? "#22c55e" : "#f59e0b";

      // Bar
      svgEl("rect", {
        x: x, y: y, width: barW, height: barH, rx: 4, ry: 4,
        fill: color, opacity: "0.8"
      }, svg);

      // Value on bar
      svgEl("text", {
        x: x + barW / 2, y: y - 6, fill: color,
        "font-size": "11", "font-weight": "600", "text-anchor": "middle",
        "font-family": "Inter, system-ui, sans-serif"
      }, svg).textContent = v;

      // Week label
      svgEl("text", {
        x: x + barW / 2, y: H - 6, fill: "#64748b",
        "font-size": "10", "text-anchor": "middle",
        "font-family": "Inter, system-ui, sans-serif"
      }, svg).textContent = "W" + (i + 1);
    });

    // Target line (dashed)
    const targetY = yPos(target);
    svgEl("line", {
      x1: padL, y1: targetY, x2: W - padR, y2: targetY,
      stroke: "rgba(255,255,255,0.5)", "stroke-width": 1.5,
      "stroke-dasharray": "8,4"
    }, svg);

    // Target label
    svgEl("text", {
      x: W - padR + 4, y: targetY + 3, fill: "rgba(255,255,255,0.5)",
      "font-size": "10", "font-weight": "500",
      "font-family": "Inter, system-ui, sans-serif"
    }, svg).textContent = "target: 4/wk";

    // Also show a second dashed line for target WIP = 4
    // (subtle, at same level since target values match, add WIP label)
    svgEl("text", {
      x: padL + 2, y: targetY - 6, fill: "rgba(255,255,255,0.35)",
      "font-size": "9",
      "font-family": "Inter, system-ui, sans-serif"
    }, svg).textContent = "target velocity: 4/wk";
  })();

})();
</script>
<div class="section-divider">Section 4 &mdash; Metrics &amp; Risk</div>
<!-- ============================================================
     Section 4: Cycle Time, Status Duration Heatmap, Risk Stack,
                WIP Alert, Bottleneck Detection, Dependency Chains
     ============================================================ -->

<style>
/* ── Section 4 Scoped Styles ───────────────────────────────── */

/* Demo item structure (scoped to group-4) */
#group-4 .demo-item {
  margin-bottom: 2.5rem;
}

#group-4 .demo-item-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.25rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid var(--border);
}

#group-4 .demo-item-number {
  font-size: 1.1rem;
  color: var(--accent);
  font-weight: 700;
  flex-shrink: 0;
}

#group-4 .demo-item-header h3 {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
  font-family: var(--font);
  flex: 1;
}

#group-4 .demo-item-tag {
  font-size: 0.65rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  padding: 0.2em 0.6em;
  border-radius: 5px;
  background: rgba(99, 102, 241, 0.1);
  color: var(--accent);
  border: 1px solid rgba(99, 102, 241, 0.2);
  flex-shrink: 0;
}

#group-4 .demo-item-body {
  /* wrapper for the actual UI mockup */
}

/* ── ⑥ Cycle Time + Lead Time ─────────────────────────────── */
.cycle-lead-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.25rem;
  font-family: var(--font);
}

.metric-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.75rem 2rem;
  position: relative;
  overflow: hidden;
  transition: background 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
}

.metric-card:hover {
  background: var(--bg-card-hover);
  border-color: rgba(99, 102, 241, 0.3);
  transform: translateY(-2px);
}

.metric-card-label {
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 0.5rem;
}

.metric-card-hero {
  display: flex;
  align-items: baseline;
  gap: 0.5rem;
  margin-bottom: 0.15rem;
}

.metric-card-hero-value {
  font-size: 3rem;
  font-weight: 800;
  color: var(--text-primary);
  line-height: 1;
  font-variant-numeric: tabular-nums;
}

.metric-card-hero-unit {
  font-size: 1.1rem;
  font-weight: 500;
  color: var(--text-secondary);
}

.metric-card-hero-label {
  font-size: 0.8rem;
  color: var(--text-secondary);
  margin-bottom: 0.75rem;
}

.metric-card-p90 {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.78rem;
  color: var(--text-muted);
  background: rgba(99, 102, 241, 0.06);
  border: 1px solid rgba(99, 102, 241, 0.12);
  border-radius: 6px;
  padding: 0.25em 0.6em;
  margin-bottom: 1.25rem;
  font-variant-numeric: tabular-nums;
}

.metric-card-p90-value {
  font-weight: 700;
  color: var(--text-secondary);
}

.metric-card-histogram {
  margin-top: 0.5rem;
}

.metric-card-histogram-label {
  font-size: 0.65rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.4rem;
}

.metric-card.cycle-time {
  border-top: 3px solid var(--accent);
}

.metric-card.lead-time {
  border-top: 3px solid #38bdf8;
}

/* ── ⑦ Status Duration Heatmap ────────────────────────────── */
.status-heatmap {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.75rem 2rem;
  font-family: var(--font);
}

.status-heatmap-title {
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 1.25rem;
}

.heatmap-row {
  display: grid;
  grid-template-columns: 110px 60px 1fr;
  align-items: center;
  gap: 1rem;
  margin-bottom: 0.75rem;
  position: relative;
}

.heatmap-row:last-child {
  margin-bottom: 0;
}

.heatmap-status-name {
  font-size: 0.82rem;
  font-weight: 500;
  color: var(--text-secondary);
  font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
}

.heatmap-days {
  font-size: 0.85rem;
  font-weight: 700;
  color: var(--text-primary);
  text-align: right;
  font-variant-numeric: tabular-nums;
}

.heatmap-days.terminal {
  color: var(--text-muted);
  font-weight: 400;
  font-style: italic;
}

.heatmap-bar-container {
  height: 26px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.heatmap-bar {
  height: 100%;
  border-radius: 4px;
  transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1);
  position: relative;
}

.heatmap-bar.heat-green {
  background: linear-gradient(90deg, rgba(34, 197, 94, 0.25), rgba(34, 197, 94, 0.6));
}

.heatmap-bar.heat-yellow {
  background: linear-gradient(90deg, rgba(34, 197, 94, 0.2), rgba(245, 158, 11, 0.6));
}

.heatmap-bar.heat-orange {
  background: linear-gradient(90deg, rgba(34, 197, 94, 0.15), rgba(249, 115, 22, 0.6));
}

.heatmap-bar.heat-red {
  background: linear-gradient(90deg, rgba(34, 197, 94, 0.1), rgba(239, 68, 68, 0.6));
}

.heatmap-bottleneck-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--danger);
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.25);
  border-radius: 4px;
  padding: 0.15em 0.5em;
  margin-left: 0.75rem;
  animation: bottleneckPulse 2s ease-in-out infinite;
}

@keyframes bottleneckPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

/* ── ⑮ Risk Stack Panel ───────────────────────────────────── */
.risk-stack {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  font-family: var(--font);
}

.risk-stack-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.25rem 1.75rem;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, var(--bg-card) 0%, rgba(239, 68, 68, 0.03) 100%);
}

.risk-stack-title {
  font-size: 0.78rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.risk-stack-title-icon {
  width: 18px;
  height: 18px;
  color: var(--danger);
}

.risk-stack-count {
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--text-muted);
  background: rgba(255, 255, 255, 0.04);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 0.2em 0.7em;
}

.risk-item {
  display: flex;
  gap: 0;
  padding: 0;
  border-bottom: 1px solid var(--border);
  transition: background 0.15s ease;
}

.risk-item:last-child {
  border-bottom: none;
}

.risk-item:hover {
  background: var(--bg-card-hover);
}

.risk-severity-bar {
  width: 4px;
  flex-shrink: 0;
}

.risk-severity-bar.critical { background: var(--danger); }
.risk-severity-bar.high { background: #f97316; }
.risk-severity-bar.moderate { background: var(--warning); }
.risk-severity-bar.low { background: var(--text-muted); }

.risk-item-content {
  flex: 1;
  padding: 1rem 1.5rem;
  min-width: 0;
}

.risk-item-top {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  margin-bottom: 0.3rem;
}

.risk-severity-label {
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  padding: 0.15em 0.5em;
  border-radius: 3px;
}

.risk-severity-label.critical {
  color: var(--danger);
  background: rgba(239, 68, 68, 0.12);
}

.risk-severity-label.high {
  color: #f97316;
  background: rgba(249, 115, 22, 0.12);
}

.risk-severity-label.moderate {
  color: var(--warning);
  background: rgba(245, 158, 11, 0.12);
}

.risk-severity-label.low {
  color: var(--text-muted);
  background: rgba(148, 163, 184, 0.1);
}

.risk-task-id {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--accent);
  cursor: pointer;
  text-decoration: none;
  font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
}

.risk-task-id:hover {
  text-decoration: underline;
}

.risk-task-title {
  font-size: 0.82rem;
  color: var(--text-primary);
  font-weight: 500;
}

.risk-reason {
  font-size: 0.75rem;
  color: var(--text-muted);
  line-height: 1.4;
}

/* ── ㉒ WIP Alert ─────────────────────────────────────────── */
.wip-alert {
  background: var(--bg-card);
  border: 2px solid rgba(245, 158, 11, 0.4);
  border-radius: var(--radius);
  padding: 1.75rem 2rem;
  font-family: var(--font);
  position: relative;
  overflow: hidden;
}

.wip-alert::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--warning), #f97316);
}

.wip-alert-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.25rem;
}

.wip-alert-title {
  display: flex;
  align-items: center;
  gap: 0.6rem;
}

.wip-alert-icon {
  width: 20px;
  height: 20px;
  color: var(--warning);
}

.wip-alert-title-text {
  font-size: 0.82rem;
  font-weight: 700;
  color: var(--text-primary);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.wip-alert-severity {
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  padding: 0.25em 0.7em;
  border-radius: 6px;
  color: var(--warning);
  background: rgba(245, 158, 11, 0.12);
  border: 1px solid rgba(245, 158, 11, 0.25);
}

.wip-alert-metrics {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1.25rem;
}

.wip-metric {
  text-align: center;
}

.wip-metric-label {
  font-size: 0.68rem;
  font-weight: 500;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.04em;
  margin-bottom: 0.25rem;
}

.wip-metric-value {
  font-size: 1.5rem;
  font-weight: 800;
  color: var(--text-primary);
  font-variant-numeric: tabular-nums;
}

.wip-metric-value.over {
  color: var(--warning);
}

.wip-metric-value .wip-limit {
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--text-muted);
}

.wip-progress-container {
  margin-bottom: 1.25rem;
}

.wip-progress-labels {
  display: flex;
  justify-content: space-between;
  font-size: 0.68rem;
  color: var(--text-muted);
  margin-bottom: 0.4rem;
}

.wip-progress-track {
  height: 10px;
  background: rgba(255, 255, 255, 0.04);
  border-radius: 5px;
  position: relative;
  overflow: visible;
}

.wip-progress-fill {
  height: 100%;
  border-radius: 5px;
  transition: width 1s cubic-bezier(0.22, 1, 0.36, 1);
  position: relative;
}

.wip-progress-fill.warning {
  background: linear-gradient(90deg, var(--accent), var(--warning));
}

.wip-progress-limit-marker {
  position: absolute;
  top: -4px;
  bottom: -4px;
  width: 2px;
  background: var(--text-muted);
  border-radius: 1px;
}

.wip-progress-limit-label {
  position: absolute;
  top: -20px;
  font-size: 0.6rem;
  color: var(--text-muted);
  transform: translateX(-50%);
  white-space: nowrap;
}

.wip-timeline {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.25rem;
  padding: 0.75rem 1rem;
  background: rgba(245, 158, 11, 0.04);
  border: 1px solid rgba(245, 158, 11, 0.12);
  border-radius: 8px;
}

.wip-timeline-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--warning);
  flex-shrink: 0;
}

.wip-timeline-line {
  flex: 1;
  height: 2px;
  background: repeating-linear-gradient(
    90deg,
    rgba(245, 158, 11, 0.3),
    rgba(245, 158, 11, 0.3) 4px,
    transparent 4px,
    transparent 8px
  );
}

.wip-timeline-dot-now {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--warning);
  flex-shrink: 0;
  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
  animation: wipNowPulse 2s ease-in-out infinite;
}

@keyframes wipNowPulse {
  0%, 100% { box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2); }
  50% { box-shadow: 0 0 0 6px rgba(245, 158, 11, 0.1); }
}

.wip-timeline-labels {
  display: flex;
  justify-content: space-between;
  margin-top: -0.25rem;
}

.wip-timeline-label {
  font-size: 0.68rem;
  color: var(--text-muted);
}

.wip-timeline-label.now {
  font-weight: 600;
  color: var(--warning);
}

.wip-recommendation {
  font-size: 0.78rem;
  color: var(--text-secondary);
  line-height: 1.5;
  padding: 0.75rem 1rem;
  background: rgba(99, 102, 241, 0.04);
  border-left: 3px solid var(--accent);
  border-radius: 0 6px 6px 0;
}

.wip-recommendation strong {
  color: var(--text-primary);
  font-weight: 600;
}

.wip-recommendation .task-ref {
  color: var(--accent);
  font-weight: 600;
  font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
  font-size: 0.75rem;
}

/* ── ㉓ Bottleneck Detection ──────────────────────────────── */
.bottleneck-panel {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.75rem 2rem;
  font-family: var(--font);
}

.bottleneck-header {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  margin-bottom: 1.5rem;
}

.bottleneck-header-icon {
  width: 20px;
  height: 20px;
  color: var(--danger);
}

.bottleneck-header-text {
  font-size: 0.78rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--text-primary);
}

.bottleneck-header-status {
  font-size: 0.78rem;
  font-weight: 700;
  color: var(--danger);
  font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
}

.bottleneck-flow-visual {
  display: flex;
  align-items: center;
  gap: 0;
  margin-bottom: 1.75rem;
  position: relative;
}

.bottleneck-flow-arrow {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
  flex: 1;
}

.bottleneck-flow-arrow-label {
  font-size: 0.65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.bottleneck-flow-arrow-label.inflow { color: #38bdf8; }
.bottleneck-flow-arrow-label.outflow { color: var(--success); }

.bottleneck-flow-arrow-rate {
  font-size: 1.1rem;
  font-weight: 800;
  font-variant-numeric: tabular-nums;
}

.bottleneck-flow-arrow-rate.inflow { color: #38bdf8; }
.bottleneck-flow-arrow-rate.outflow { color: var(--success); }

.bottleneck-flow-arrow-unit {
  font-size: 0.65rem;
  color: var(--text-muted);
}

.bottleneck-funnel {
  flex-shrink: 0;
  position: relative;
}

.bottleneck-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.bottleneck-stat {
  padding: 1rem;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid var(--border);
  border-radius: 8px;
}

.bottleneck-stat-label {
  font-size: 0.68rem;
  font-weight: 500;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.04em;
  margin-bottom: 0.35rem;
}

.bottleneck-stat-value {
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--text-primary);
  font-variant-numeric: tabular-nums;
}

.bottleneck-stat-value.danger { color: var(--danger); }
.bottleneck-stat-value.warning { color: var(--warning); }

.bottleneck-projection {
  padding: 1rem 1.25rem;
  background: rgba(239, 68, 68, 0.04);
  border: 1px solid rgba(239, 68, 68, 0.12);
  border-radius: 8px;
}

.bottleneck-projection-title {
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.75rem;
}

/* ── ㉔ Dependency Chain Risk ─────────────────────────────── */
.dep-chain-panel {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.75rem 2rem;
  font-family: var(--font);
}

.dep-chain-header {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  margin-bottom: 1.5rem;
}

.dep-chain-header-icon {
  width: 20px;
  height: 20px;
  color: var(--accent);
}

.dep-chain-header-text {
  font-size: 0.78rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--text-primary);
}

.dep-chain {
  margin-bottom: 1.5rem;
  padding: 1.25rem 1.5rem;
  background: rgba(255, 255, 255, 0.015);
  border: 1px solid var(--border);
  border-radius: 10px;
}

.dep-chain:last-child {
  margin-bottom: 0;
}

.dep-chain-title {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  margin-bottom: 1rem;
}

.dep-chain-label {
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--text-secondary);
}

.dep-chain-severity-badge {
  font-size: 0.58rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  padding: 0.15em 0.5em;
  border-radius: 3px;
}

.dep-chain-severity-badge.critical {
  color: var(--danger);
  background: rgba(239, 68, 68, 0.12);
}

.dep-chain-severity-badge.high {
  color: #f97316;
  background: rgba(249, 115, 22, 0.12);
}

.dep-chain-depth {
  font-size: 0.68rem;
  color: var(--text-muted);
  margin-left: auto;
}

.dep-chain-graph {
  margin-bottom: 0.75rem;
}

.dep-chain-impact {
  font-size: 0.75rem;
  color: var(--text-muted);
  line-height: 1.4;
  padding-top: 0.75rem;
  border-top: 1px solid var(--border);
}

.dep-chain-impact strong {
  color: var(--text-secondary);
  font-weight: 600;
}

/* ── Shared animation classes ─────────────────────────────── */
#group-4 .animate-on-scroll {
  opacity: 0;
  transform: translateY(24px);
}

#group-4 .animate-on-scroll.in-view {
  animation: s4FadeSlideUp 0.7s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

@keyframes s4FadeSlideUp {
  from {
    opacity: 0;
    transform: translateY(24px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes s4BarGrow {
  from { width: 0; }
}
</style>

<div class="demo-group" id="group-4">

  <!-- ⑥ Cycle Time + Lead Time -->
  <div class="demo-item" id="item-6">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9317;</span>
      <h3>Cycle Time + Lead Time</h3>
      <span class="demo-item-tag">Metrics</span>
    </div>
    <div class="demo-item-body">
      <div class="cycle-lead-grid">

        <!-- Cycle Time Card -->
        <div class="metric-card cycle-time animate-on-scroll">
          <div class="metric-card-label">Cycle Time <span style="color:var(--text-muted);font-weight:400;text-transform:none;letter-spacing:0;">(in_progress &rarr; done)</span></div>
          <div class="metric-card-hero">
            <span class="metric-card-hero-value" data-s4-countup="4.2" data-decimals="1">0.0</span>
            <span class="metric-card-hero-unit">days</span>
          </div>
          <div class="metric-card-hero-label">Median</div>
          <div class="metric-card-p90">
            P90 <span class="metric-card-p90-value">8.1d</span>
          </div>
          <div class="metric-card-histogram">
            <div class="metric-card-histogram-label">Distribution</div>
            <svg width="100%" height="60" viewBox="0 0 260 60" preserveAspectRatio="none" aria-label="Cycle time distribution histogram">
              <defs>
                <linearGradient id="s4-cycle-grad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="rgba(99,102,241,0.7)" />
                  <stop offset="100%" stop-color="rgba(99,102,241,0.15)" />
                </linearGradient>
              </defs>
              <!-- 8 buckets, max value = 8, bar height = (val/8)*48 -->
              <!-- 0-1d: 2 -->
              <rect x="4" y="48" width="26" height="0" rx="2" fill="url(#s4-cycle-grad)" class="s4-hist-bar" data-target-h="12" data-target-y="36"/>
              <text x="17" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">0-1d</text>
              <!-- 1-2d: 4 -->
              <rect x="36" y="48" width="26" height="0" rx="2" fill="url(#s4-cycle-grad)" class="s4-hist-bar" data-target-h="24" data-target-y="24"/>
              <text x="49" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">1-2d</text>
              <!-- 2-3d: 5 -->
              <rect x="68" y="48" width="26" height="0" rx="2" fill="url(#s4-cycle-grad)" class="s4-hist-bar" data-target-h="30" data-target-y="18"/>
              <text x="81" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">2-3d</text>
              <!-- 3-5d: 8 (peak) -->
              <rect x="100" y="48" width="26" height="0" rx="2" fill="var(--accent)" class="s4-hist-bar" data-target-h="48" data-target-y="0"/>
              <text x="113" y="58" text-anchor="middle" font-size="7" fill="var(--text-secondary)" font-weight="600" font-family="var(--font)">3-5d</text>
              <!-- 5-7d: 3 -->
              <rect x="132" y="48" width="26" height="0" rx="2" fill="url(#s4-cycle-grad)" class="s4-hist-bar" data-target-h="18" data-target-y="30"/>
              <text x="145" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">5-7d</text>
              <!-- 7-10d: 2 -->
              <rect x="164" y="48" width="26" height="0" rx="2" fill="url(#s4-cycle-grad)" class="s4-hist-bar" data-target-h="12" data-target-y="36"/>
              <text x="177" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">7-10d</text>
              <!-- 10-14d: 1 -->
              <rect x="196" y="48" width="26" height="0" rx="2" fill="url(#s4-cycle-grad)" class="s4-hist-bar" data-target-h="6" data-target-y="42"/>
              <text x="209" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">10-14</text>
              <!-- 14d+: 1 -->
              <rect x="228" y="48" width="26" height="0" rx="2" fill="url(#s4-cycle-grad)" class="s4-hist-bar" data-target-h="6" data-target-y="42"/>
              <text x="241" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">14d+</text>
            </svg>
          </div>
        </div>

        <!-- Lead Time Card -->
        <div class="metric-card lead-time animate-on-scroll">
          <div class="metric-card-label">Lead Time <span style="color:var(--text-muted);font-weight:400;text-transform:none;letter-spacing:0;">(created &rarr; done)</span></div>
          <div class="metric-card-hero">
            <span class="metric-card-hero-value" data-s4-countup="11.3" data-decimals="1">0.0</span>
            <span class="metric-card-hero-unit">days</span>
          </div>
          <div class="metric-card-hero-label">Median</div>
          <div class="metric-card-p90">
            P90 <span class="metric-card-p90-value">22.5d</span>
          </div>
          <div class="metric-card-histogram">
            <div class="metric-card-histogram-label">Distribution</div>
            <svg width="100%" height="60" viewBox="0 0 260 60" preserveAspectRatio="none" aria-label="Lead time distribution histogram">
              <defs>
                <linearGradient id="s4-lead-grad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="rgba(56,189,248,0.7)" />
                  <stop offset="100%" stop-color="rgba(56,189,248,0.15)" />
                </linearGradient>
              </defs>
              <!-- 8 buckets, max value = 7, bar height = (val/7)*48 -->
              <!-- 0-3d: 1 -->
              <rect x="4" y="48" width="26" height="0" rx="2" fill="url(#s4-lead-grad)" class="s4-hist-bar" data-target-h="6.86" data-target-y="41.14"/>
              <text x="17" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">0-3d</text>
              <!-- 3-5d: 2 -->
              <rect x="36" y="48" width="26" height="0" rx="2" fill="url(#s4-lead-grad)" class="s4-hist-bar" data-target-h="13.71" data-target-y="34.29"/>
              <text x="49" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">3-5d</text>
              <!-- 5-7d: 3 -->
              <rect x="68" y="48" width="26" height="0" rx="2" fill="url(#s4-lead-grad)" class="s4-hist-bar" data-target-h="20.57" data-target-y="27.43"/>
              <text x="81" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">5-7d</text>
              <!-- 7-10d: 5 -->
              <rect x="100" y="48" width="26" height="0" rx="2" fill="url(#s4-lead-grad)" class="s4-hist-bar" data-target-h="34.29" data-target-y="13.71"/>
              <text x="113" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">7-10d</text>
              <!-- 10-14d: 7 (peak) -->
              <rect x="132" y="48" width="26" height="0" rx="2" fill="#38bdf8" class="s4-hist-bar" data-target-h="48" data-target-y="0"/>
              <text x="145" y="58" text-anchor="middle" font-size="7" fill="var(--text-secondary)" font-weight="600" font-family="var(--font)">10-14</text>
              <!-- 14-21d: 4 -->
              <rect x="164" y="48" width="26" height="0" rx="2" fill="url(#s4-lead-grad)" class="s4-hist-bar" data-target-h="27.43" data-target-y="20.57"/>
              <text x="177" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">14-21</text>
              <!-- 21-30d: 2 -->
              <rect x="196" y="48" width="26" height="0" rx="2" fill="url(#s4-lead-grad)" class="s4-hist-bar" data-target-h="13.71" data-target-y="34.29"/>
              <text x="209" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">21-30</text>
              <!-- 30d+: 1 -->
              <rect x="228" y="48" width="26" height="0" rx="2" fill="url(#s4-lead-grad)" class="s4-hist-bar" data-target-h="6.86" data-target-y="41.14"/>
              <text x="241" y="58" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">30d+</text>
            </svg>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ⑦ Status Duration Heatmap -->
  <div class="demo-item" id="item-7">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9318;</span>
      <h3>Status Duration Heatmap</h3>
      <span class="demo-item-tag">Analysis</span>
    </div>
    <div class="demo-item-body">
      <div class="status-heatmap animate-on-scroll">
        <div class="status-heatmap-title">Average Days in Status</div>

        <!-- backlog: 8.2d — orange (7-14d) -->
        <div class="heatmap-row">
          <span class="heatmap-status-name">backlog</span>
          <span class="heatmap-days">8.2d</span>
          <div class="heatmap-bar-container">
            <div class="heatmap-bar heat-orange s4-heatmap-bar" style="width:0%" data-target-width="64.6%"></div>
          </div>
        </div>

        <!-- in_planning: 3.1d — yellow (3-7d) -->
        <div class="heatmap-row">
          <span class="heatmap-status-name">in_planning</span>
          <span class="heatmap-days">3.1d</span>
          <div class="heatmap-bar-container">
            <div class="heatmap-bar heat-yellow s4-heatmap-bar" style="width:0%" data-target-width="24.4%"></div>
          </div>
        </div>

        <!-- planned: 5.4d — yellow (3-7d) -->
        <div class="heatmap-row">
          <span class="heatmap-status-name">planned</span>
          <span class="heatmap-days">5.4d</span>
          <div class="heatmap-bar-container">
            <div class="heatmap-bar heat-yellow s4-heatmap-bar" style="width:0%" data-target-width="42.5%"></div>
          </div>
        </div>

        <!-- in_progress: 4.2d — yellow (3-7d) -->
        <div class="heatmap-row">
          <span class="heatmap-status-name">in_progress</span>
          <span class="heatmap-days">4.2d</span>
          <div class="heatmap-bar-container">
            <div class="heatmap-bar heat-yellow s4-heatmap-bar" style="width:0%" data-target-width="33.1%"></div>
          </div>
        </div>

        <!-- review: 12.7d — red (>14d threshold treated as near) — BOTTLENECK -->
        <div class="heatmap-row">
          <span class="heatmap-status-name">review</span>
          <span class="heatmap-days">12.7d</span>
          <div class="heatmap-bar-container">
            <div class="heatmap-bar heat-red s4-heatmap-bar" style="width:0%" data-target-width="100%"></div>
          </div>
          <span class="heatmap-bottleneck-badge">&#9888; Bottleneck</span>
        </div>

        <!-- done: terminal -->
        <div class="heatmap-row">
          <span class="heatmap-status-name">done</span>
          <span class="heatmap-days terminal">&mdash;</span>
          <div class="heatmap-bar-container">
            <!-- no bar for terminal state -->
          </div>
        </div>

        <!-- blocked: 9.5d — orange (7-14d) -->
        <div class="heatmap-row">
          <span class="heatmap-status-name">blocked</span>
          <span class="heatmap-days">9.5d</span>
          <div class="heatmap-bar-container">
            <div class="heatmap-bar heat-orange s4-heatmap-bar" style="width:0%" data-target-width="74.8%"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ⑮ Risk Stack Panel -->
  <div class="demo-item" id="item-15">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9326;</span>
      <h3>Risk Stack Panel</h3>
      <span class="demo-item-tag">Risk</span>
    </div>
    <div class="demo-item-body">
      <div class="risk-stack animate-on-scroll">

        <div class="risk-stack-header">
          <div class="risk-stack-title">
            <svg class="risk-stack-title-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M10 2L18 17H2L10 2Z" stroke-linejoin="round"/>
              <line x1="10" y1="8" x2="10" y2="12" stroke-linecap="round"/>
              <circle cx="10" cy="14.5" r="0.75" fill="currentColor" stroke="none"/>
            </svg>
            Risk Stack
          </div>
          <span class="risk-stack-count">5 items needing attention</span>
        </div>

        <!-- CRITICAL: LAT-18 -->
        <div class="risk-item">
          <div class="risk-severity-bar critical"></div>
          <div class="risk-item-content">
            <div class="risk-item-top">
              <span class="risk-severity-label critical">Critical</span>
              <a href="#" class="risk-task-id">LAT-18</a>
              <span class="risk-task-title">&ldquo;Add relationship validation&rdquo;</span>
            </div>
            <div class="risk-reason">Stale 12 days, in_progress, blocking 2 tasks</div>
          </div>
        </div>

        <!-- HIGH: LAT-29 -->
        <div class="risk-item">
          <div class="risk-severity-bar high"></div>
          <div class="risk-item-content">
            <div class="risk-item-top">
              <span class="risk-severity-label high">High</span>
              <a href="#" class="risk-task-id">LAT-29</a>
              <span class="risk-task-title">&ldquo;Archive cascade for relationships&rdquo;</span>
            </div>
            <div class="risk-reason">Blocked, chain depth 2 (via LAT-31 &rarr; LAT-18)</div>
          </div>
        </div>

        <!-- HIGH: LAT-31 -->
        <div class="risk-item">
          <div class="risk-severity-bar high"></div>
          <div class="risk-item-content">
            <div class="risk-item-top">
              <span class="risk-severity-label high">High</span>
              <a href="#" class="risk-task-id">LAT-31</a>
              <span class="risk-task-title">&ldquo;Implement blocked-by enforcement&rdquo;</span>
            </div>
            <div class="risk-reason">Blocked by stale task LAT-18</div>
          </div>
        </div>

        <!-- MODERATE: LAT-22 -->
        <div class="risk-item">
          <div class="risk-severity-bar moderate"></div>
          <div class="risk-item-content">
            <div class="risk-item-top">
              <span class="risk-severity-label moderate">Moderate</span>
              <a href="#" class="risk-task-id">LAT-22</a>
              <span class="risk-task-title">&ldquo;Design artifact linking UX&rdquo;</span>
            </div>
            <div class="risk-reason">Stale 14 days, planned (not blocking others)</div>
          </div>
        </div>

        <!-- LOW: WIP breach -->
        <div class="risk-item">
          <div class="risk-severity-bar low"></div>
          <div class="risk-item-content">
            <div class="risk-item-top">
              <span class="risk-severity-label low">Low</span>
              <span class="risk-task-title" style="color:var(--text-secondary);">in_progress WIP exceeded (5/4) for 3 days</span>
            </div>
            <div class="risk-reason">Capacity constraint, not directly blocking deliverables</div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ㉒ WIP Alert Severity + Time-over-limit -->
  <div class="demo-item" id="item-22">
    <div class="demo-item-header">
      <span class="demo-item-number">&#12883;</span>
      <h3>WIP Alert Severity + Time-over-limit</h3>
      <span class="demo-item-tag">Alert</span>
    </div>
    <div class="demo-item-body">
      <div class="wip-alert animate-on-scroll">

        <div class="wip-alert-header">
          <div class="wip-alert-title">
            <svg class="wip-alert-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M10 2L18 17H2L10 2Z" stroke-linejoin="round"/>
              <line x1="10" y1="8" x2="10" y2="12" stroke-linecap="round"/>
              <circle cx="10" cy="14.5" r="0.75" fill="currentColor" stroke="none"/>
            </svg>
            <span class="wip-alert-title-text">WIP Limit Breach &mdash; in_progress</span>
          </div>
          <span class="wip-alert-severity">Warning</span>
        </div>

        <div class="wip-alert-metrics">
          <div class="wip-metric">
            <div class="wip-metric-label">Current</div>
            <div class="wip-metric-value over">5</div>
          </div>
          <div class="wip-metric">
            <div class="wip-metric-label">Limit</div>
            <div class="wip-metric-value">4</div>
          </div>
          <div class="wip-metric">
            <div class="wip-metric-label">Over By</div>
            <div class="wip-metric-value over">+1</div>
          </div>
        </div>

        <!-- Progress bar overflowing past limit -->
        <div class="wip-progress-container">
          <div class="wip-progress-labels">
            <span>0</span>
            <span>Capacity</span>
          </div>
          <div class="wip-progress-track">
            <div class="wip-progress-fill warning s4-wip-bar" style="width:0%" data-target-width="125%"></div>
            <div class="wip-progress-limit-marker" style="left:80%;">
              <span class="wip-progress-limit-label">Limit: 4</span>
            </div>
          </div>
        </div>

        <!-- Timeline -->
        <div style="margin-bottom: 1.25rem;">
          <div class="wip-timeline">
            <div class="wip-timeline-dot"></div>
            <div class="wip-timeline-line"></div>
            <div class="wip-timeline-dot-now"></div>
          </div>
          <div class="wip-timeline-labels">
            <span class="wip-timeline-label">Feb 12 &mdash; breached</span>
            <span class="wip-timeline-label now">Now (3d over)</span>
          </div>
        </div>

        <div class="wip-recommendation">
          <strong>Recommendation:</strong> Consider moving <span class="task-ref">LAT-38</span> to review or reassigning to reduce in_progress count below the WIP limit.
        </div>

      </div>
    </div>
  </div>

  <!-- ㉓ Bottleneck Detection -->
  <div class="demo-item" id="item-23">
    <div class="demo-item-header">
      <span class="demo-item-number">&#12884;</span>
      <h3>Bottleneck Detection</h3>
      <span class="demo-item-tag">Insight</span>
    </div>
    <div class="demo-item-body">
      <div class="bottleneck-panel animate-on-scroll">

        <div class="bottleneck-header">
          <svg class="bottleneck-header-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="10" cy="10" r="8"/>
            <path d="M10 6v4l2.5 2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="bottleneck-header-text">Bottleneck Detected:</span>
          <span class="bottleneck-header-status">review</span>
        </div>

        <!-- Flow visualization -->
        <div class="bottleneck-flow-visual">
          <svg width="100%" height="120" viewBox="0 0 500 120" preserveAspectRatio="xMidYMid meet">
            <!-- Inflow side -->
            <text x="60" y="18" text-anchor="middle" font-size="10" font-weight="600" fill="#38bdf8" font-family="var(--font)" letter-spacing="0.5">ENTERING</text>
            <text x="60" y="36" text-anchor="middle" font-size="22" font-weight="800" fill="#38bdf8" font-family="var(--font)">2.1</text>
            <text x="60" y="50" text-anchor="middle" font-size="9" fill="var(--text-muted)" font-family="var(--font)">/week avg</text>

            <!-- Inflow arrow (thick) -->
            <defs>
              <marker id="s4-arrow-in" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                <path d="M0,0 L8,3 L0,6" fill="#38bdf8"/>
              </marker>
              <marker id="s4-arrow-out" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                <path d="M0,0 L8,3 L0,6" fill="var(--success)"/>
              </marker>
            </defs>
            <line x1="120" y1="72" x2="188" y2="72" stroke="#38bdf8" stroke-width="6" stroke-linecap="round" marker-end="url(#s4-arrow-in)" opacity="0.8"/>
            <text x="154" y="64" text-anchor="middle" font-size="8" fill="#38bdf8" font-family="var(--font)" font-weight="600">IN</text>

            <!-- Funnel / pipe (the review stage) -->
            <rect x="196" y="50" width="108" height="44" rx="8" fill="rgba(239,68,68,0.08)" stroke="var(--danger)" stroke-width="1.5" stroke-dasharray="4 2"/>
            <text x="250" y="68" text-anchor="middle" font-size="11" font-weight="700" fill="var(--text-primary)" font-family="var(--font)">review</text>
            <text x="250" y="84" text-anchor="middle" font-size="9" fill="var(--danger)" font-family="var(--font)" font-weight="600">accumulating</text>

            <!-- Outflow arrow (thinner) -->
            <line x1="312" y1="72" x2="380" y2="72" stroke="var(--success)" stroke-width="3" stroke-linecap="round" marker-end="url(#s4-arrow-out)" opacity="0.8"/>
            <text x="346" y="64" text-anchor="middle" font-size="8" fill="var(--success)" font-family="var(--font)" font-weight="600">OUT</text>

            <!-- Outflow side -->
            <text x="440" y="18" text-anchor="middle" font-size="10" font-weight="600" fill="var(--success)" font-family="var(--font)" letter-spacing="0.5">LEAVING</text>
            <text x="440" y="36" text-anchor="middle" font-size="22" font-weight="800" fill="var(--success)" font-family="var(--font)">1.3</text>
            <text x="440" y="50" text-anchor="middle" font-size="9" fill="var(--text-muted)" font-family="var(--font)">/week avg</text>

            <!-- Net accumulation indicator -->
            <text x="250" y="112" text-anchor="middle" font-size="10" fill="var(--warning)" font-family="var(--font)" font-weight="700">+0.8/week net accumulation</text>
          </svg>
        </div>

        <!-- Stats -->
        <div class="bottleneck-stats">
          <div class="bottleneck-stat">
            <div class="bottleneck-stat-label">Flow Ratio</div>
            <div class="bottleneck-stat-value danger">0.62</div>
            <div style="font-size:0.68rem;color:var(--text-muted);margin-top:0.2rem;">&lt; 0.8 threshold &rarr; bottleneck</div>
          </div>
          <div class="bottleneck-stat">
            <div class="bottleneck-stat-label">Time to Critical</div>
            <div class="bottleneck-stat-value warning">~3 weeks</div>
            <div style="font-size:0.68rem;color:var(--text-muted);margin-top:0.2rem;">at current rate</div>
          </div>
        </div>

        <!-- Projection chart -->
        <div class="bottleneck-projection">
          <div class="bottleneck-projection-title">Accumulation Projection (next 4 weeks)</div>
          <svg width="100%" height="80" viewBox="0 0 400 80" preserveAspectRatio="xMidYMid meet">
            <!-- Grid lines -->
            <line x1="40" y1="10" x2="40" y2="65" stroke="var(--border)" stroke-width="0.5"/>
            <line x1="130" y1="10" x2="130" y2="65" stroke="var(--border)" stroke-width="0.5"/>
            <line x1="220" y1="10" x2="220" y2="65" stroke="var(--border)" stroke-width="0.5"/>
            <line x1="310" y1="10" x2="310" y2="65" stroke="var(--border)" stroke-width="0.5"/>
            <line x1="390" y1="10" x2="390" y2="65" stroke="var(--border)" stroke-width="0.5"/>
            <!-- Horizontal base -->
            <line x1="40" y1="65" x2="390" y2="65" stroke="var(--border)" stroke-width="0.5"/>

            <!-- Danger zone background -->
            <rect x="40" y="10" width="350" height="18" rx="2" fill="rgba(239,68,68,0.05)"/>
            <text x="45" y="22" font-size="7" fill="var(--danger)" font-family="var(--font)" opacity="0.6">danger zone</text>

            <!-- Projection line (tasks in review over time) -->
            <!-- Now: ~5 tasks, +0.8/week -->
            <!-- Week 0: 5, Week 1: 5.8, Week 2: 6.6, Week 3: 7.4, Week 4: 8.2 -->
            <!-- Y scale: 0 tasks = y:65, 10 tasks = y:10 -->
            <polyline points="40,37.5 130,33.1 220,28.7 310,24.3 390,19.9"
                      fill="none" stroke="var(--danger)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                      stroke-dasharray="5 3" opacity="0.8"/>

            <!-- Current point -->
            <circle cx="40" cy="37.5" r="4" fill="var(--warning)" stroke="var(--bg-card)" stroke-width="2"/>

            <!-- Projected points -->
            <circle cx="130" cy="33.1" r="3" fill="var(--danger)" opacity="0.4"/>
            <circle cx="220" cy="28.7" r="3" fill="var(--danger)" opacity="0.5"/>
            <circle cx="310" cy="24.3" r="3" fill="var(--danger)" opacity="0.7"/>
            <circle cx="390" cy="19.9" r="3.5" fill="var(--danger)" opacity="0.9"/>

            <!-- Labels -->
            <text x="40" y="76" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="var(--font)">Now</text>
            <text x="130" y="76" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="var(--font)">Wk 1</text>
            <text x="220" y="76" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="var(--font)">Wk 2</text>
            <text x="310" y="76" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="var(--font)">Wk 3</text>
            <text x="390" y="76" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="var(--font)">Wk 4</text>

            <!-- Value labels -->
            <text x="40" y="33" text-anchor="middle" font-size="8" fill="var(--warning)" font-weight="700" font-family="var(--font)">5</text>
            <text x="390" y="15" text-anchor="middle" font-size="8" fill="var(--danger)" font-weight="700" font-family="var(--font)">~8</text>
          </svg>
        </div>

      </div>
    </div>
  </div>

  <!-- ㉔ Dependency Chain Risk -->
  <div class="demo-item" id="item-24">
    <div class="demo-item-header">
      <span class="demo-item-number">&#12885;</span>
      <h3>Dependency Chain Risk</h3>
      <span class="demo-item-tag">Graph</span>
    </div>
    <div class="demo-item-body">
      <div class="dep-chain-panel animate-on-scroll">

        <div class="dep-chain-header">
          <svg class="dep-chain-header-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="4" cy="10" r="2.5"/>
            <circle cx="16" cy="5" r="2.5"/>
            <circle cx="16" cy="15" r="2.5"/>
            <line x1="6.5" y1="9" x2="13.5" y2="6" stroke-linecap="round"/>
            <line x1="6.5" y1="11" x2="13.5" y2="14" stroke-linecap="round"/>
          </svg>
          <span class="dep-chain-header-text">Dependency Chains</span>
        </div>

        <!-- Chain 1 (depth 2, CRITICAL) -->
        <div class="dep-chain">
          <div class="dep-chain-title">
            <span class="dep-chain-label">Chain 1</span>
            <span class="dep-chain-severity-badge critical">Critical</span>
            <span class="dep-chain-depth">Depth 2</span>
          </div>
          <div class="dep-chain-graph">
            <svg width="100%" height="90" viewBox="0 0 560 90" preserveAspectRatio="xMidYMid meet">
              <defs>
                <marker id="s4-dep-arrow" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto">
                  <path d="M0,0 L7,2.5 L0,5" fill="var(--text-muted)"/>
                </marker>
                <filter id="s4-glow-red">
                  <feGaussianBlur stdDeviation="3" result="blur"/>
                  <feFlood flood-color="var(--danger)" flood-opacity="0.3"/>
                  <feComposite in2="blur" operator="in"/>
                  <feMerge>
                    <feMergeNode/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>

              <!-- LAT-29 (leaf, gray) -->
              <rect x="10" y="25" width="140" height="40" rx="8" fill="rgba(148,163,184,0.08)" stroke="var(--text-muted)" stroke-width="1.2"/>
              <text x="25" y="42" font-size="10" font-weight="700" fill="var(--accent)" font-family="'SF Mono','Fira Code',monospace">LAT-29</text>
              <text x="25" y="56" font-size="8" fill="var(--text-muted)" font-family="var(--font)">Archive cascade</text>

              <!-- Arrow LAT-29 -> LAT-31 -->
              <line x1="150" y1="45" x2="192" y2="45" stroke="var(--text-muted)" stroke-width="1.2" marker-end="url(#s4-dep-arrow)" stroke-dasharray="3 2"/>
              <text x="171" y="39" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">blocked by</text>

              <!-- LAT-31 (intermediate, orange) -->
              <rect x="200" y="25" width="155" height="40" rx="8" fill="rgba(249,115,22,0.06)" stroke="#f97316" stroke-width="1.2"/>
              <text x="215" y="42" font-size="10" font-weight="700" fill="var(--accent)" font-family="'SF Mono','Fira Code',monospace">LAT-31</text>
              <text x="215" y="56" font-size="8" fill="var(--text-muted)" font-family="var(--font)">Blocked-by enforcement</text>

              <!-- Arrow LAT-31 -> LAT-18 -->
              <line x1="355" y1="45" x2="397" y2="45" stroke="var(--text-muted)" stroke-width="1.2" marker-end="url(#s4-dep-arrow)" stroke-dasharray="3 2"/>
              <text x="376" y="39" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">blocked by</text>

              <!-- LAT-18 (root blocker, red, prominent) -->
              <rect x="405" y="20" width="145" height="50" rx="8" fill="rgba(239,68,68,0.08)" stroke="var(--danger)" stroke-width="2" filter="url(#s4-glow-red)"/>
              <text x="420" y="40" font-size="11" font-weight="800" fill="var(--danger)" font-family="'SF Mono','Fira Code',monospace">LAT-18</text>
              <text x="420" y="54" font-size="8" fill="var(--text-secondary)" font-family="var(--font)">Relationship validation</text>
              <text x="420" y="65" font-size="7" fill="var(--danger)" font-family="var(--font)" font-weight="600">stale 12d &bull; ROOT CAUSE</text>
            </svg>
          </div>
          <div class="dep-chain-impact">
            <strong>Impact:</strong> 3 tasks affected, deepest block is stale for 12 days
          </div>
        </div>

        <!-- Chain 2 (depth 1, HIGH) -->
        <div class="dep-chain">
          <div class="dep-chain-title">
            <span class="dep-chain-label">Chain 2</span>
            <span class="dep-chain-severity-badge high">High</span>
            <span class="dep-chain-depth">Depth 1</span>
          </div>
          <div class="dep-chain-graph">
            <svg width="100%" height="90" viewBox="0 0 560 90" preserveAspectRatio="xMidYMid meet">
              <!-- LAT-33 (leaf, gray) -->
              <rect x="60" y="25" width="160" height="40" rx="8" fill="rgba(148,163,184,0.08)" stroke="var(--text-muted)" stroke-width="1.2"/>
              <text x="75" y="42" font-size="10" font-weight="700" fill="var(--accent)" font-family="'SF Mono','Fira Code',monospace">LAT-33</text>
              <text x="75" y="56" font-size="8" fill="var(--text-muted)" font-family="var(--font)">Depends on validation</text>

              <!-- Arrow LAT-33 -> LAT-18 -->
              <line x1="220" y1="45" x2="337" y2="45" stroke="var(--text-muted)" stroke-width="1.2" marker-end="url(#s4-dep-arrow)" stroke-dasharray="3 2"/>
              <text x="278" y="39" text-anchor="middle" font-size="7" fill="var(--text-muted)" font-family="var(--font)">blocked by</text>

              <!-- LAT-18 (root blocker, red, prominent) — shared root cause -->
              <rect x="345" y="20" width="155" height="50" rx="8" fill="rgba(239,68,68,0.08)" stroke="var(--danger)" stroke-width="2" filter="url(#s4-glow-red)"/>
              <text x="360" y="40" font-size="11" font-weight="800" fill="var(--danger)" font-family="'SF Mono','Fira Code',monospace">LAT-18</text>
              <text x="360" y="54" font-size="8" fill="var(--text-secondary)" font-family="var(--font)">Relationship validation</text>
              <text x="360" y="65" font-size="7" fill="var(--danger)" font-family="var(--font)" font-weight="600">SHARED ROOT CAUSE</text>
            </svg>
          </div>
          <div class="dep-chain-impact">
            <strong>Impact:</strong> Shares root cause with Chain 1 &mdash; resolving LAT-18 unblocks both chains
          </div>
        </div>

      </div>
    </div>
  </div>

</div>

<script>
(function() {
  'use strict';

  /* ── Counter Animation (supports decimals) ────────────── */
  function animateCountUpDecimal(el, target, decimals, duration) {
    if (el.dataset.counted === 'true') return;
    el.dataset.counted = 'true';
    var start = performance.now();

    function easeOutExpo(t) {
      return t === 1 ? 1 : 1 - Math.pow(2, -10 * t);
    }

    function tick(now) {
      var elapsed = now - start;
      var progress = Math.min(elapsed / duration, 1);
      var value = target * easeOutExpo(progress);
      el.textContent = value.toFixed(decimals);
      if (progress < 1) {
        requestAnimationFrame(tick);
      } else {
        el.textContent = target.toFixed(decimals);
      }
    }
    requestAnimationFrame(tick);
  }

  /* ── Histogram Bar Animation ──────────────────────────── */
  function animateHistogramBars(container) {
    var bars = container.querySelectorAll('.s4-hist-bar');
    bars.forEach(function(bar, i) {
      var targetH = parseFloat(bar.getAttribute('data-target-h'));
      var targetY = parseFloat(bar.getAttribute('data-target-y'));
      setTimeout(function() {
        bar.setAttribute('height', targetH);
        bar.setAttribute('y', targetY);
        bar.style.transition = 'all 0.6s cubic-bezier(0.22, 1, 0.36, 1)';
      }, i * 60);
    });
  }

  /* ── Heatmap Bar Animation ────────────────────────────── */
  function animateHeatmapBars(container) {
    var bars = container.querySelectorAll('.s4-heatmap-bar');
    bars.forEach(function(bar, i) {
      var targetWidth = bar.getAttribute('data-target-width');
      setTimeout(function() {
        bar.style.width = targetWidth;
      }, i * 100);
    });
  }

  /* ── WIP Progress Bar Animation ───────────────────────── */
  function animateWipBar(container) {
    var bar = container.querySelector('.s4-wip-bar');
    if (bar) {
      var targetWidth = bar.getAttribute('data-target-width');
      setTimeout(function() {
        bar.style.width = targetWidth;
      }, 300);
    }
  }

  /* ── IntersectionObserver ─────────────────────────────── */
  var observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      if (!entry.isIntersecting) return;

      var el = entry.target;
      el.classList.add('in-view');

      /* Countup for decimal metrics */
      var counters = el.querySelectorAll('[data-s4-countup]');
      counters.forEach(function(counter) {
        var target = parseFloat(counter.getAttribute('data-s4-countup'));
        var decimals = parseInt(counter.getAttribute('data-decimals') || '0', 10);
        setTimeout(function() {
          animateCountUpDecimal(counter, target, decimals, 1400);
        }, 300);
      });

      /* Histogram bars */
      var histBars = el.querySelectorAll('.s4-hist-bar');
      if (histBars.length > 0) {
        setTimeout(function() {
          animateHistogramBars(el);
        }, 400);
      }

      /* Heatmap bars */
      var heatBars = el.querySelectorAll('.s4-heatmap-bar');
      if (heatBars.length > 0) {
        setTimeout(function() {
          animateHeatmapBars(el);
        }, 300);
      }

      /* WIP progress bar */
      var wipBar = el.querySelector('.s4-wip-bar');
      if (wipBar) {
        setTimeout(function() {
          animateWipBar(el);
        }, 400);
      }

      observer.unobserve(el);
    });
  }, {
    threshold: 0.15,
    rootMargin: '0px 0px -40px 0px'
  });

  /* ── Observe all animate-on-scroll elements in group-4 ── */
  var group = document.getElementById('group-4');
  if (group) {
    var targets = group.querySelectorAll('.animate-on-scroll');
    targets.forEach(function(el) {
      observer.observe(el);
    });
  }
})();
</script>
<div class="section-divider">Section 5 &mdash; Interactivity &amp; Actions</div>
<style>
/* ============================================================
   Section 5 — Polish & Action Items
   Items: 10 (Dark Mode), 11 (Clickable Everything),
          12 (Time Range), 13 (Collapsible), 20 (Export),
          26 (Recommended Actions)
   ============================================================ */

/* --- Dark Mode / Theme Toggle (Item 10) --- */
#item-10 .theme-demo-area {
  position: relative;
}

#item-10 .theme-toggle-wrap {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 16px;
}

#item-10 .theme-toggle {
  display: flex;
  align-items: center;
  gap: 10px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 24px;
  padding: 6px 14px;
  cursor: pointer;
  user-select: none;
  transition: all 0.3s ease;
}

#item-10 .theme-toggle:hover {
  border-color: var(--accent);
  background: var(--bg-card-hover);
}

#item-10 .theme-toggle-track {
  width: 44px;
  height: 24px;
  background: var(--border);
  border-radius: 12px;
  position: relative;
  transition: background 0.3s ease;
}

#item-10 .theme-toggle-track.active {
  background: var(--accent);
}

#item-10 .theme-toggle-thumb {
  width: 18px;
  height: 18px;
  background: #fff;
  border-radius: 50%;
  position: absolute;
  top: 3px;
  left: 3px;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

#item-10 .theme-toggle-track.active .theme-toggle-thumb {
  transform: translateX(20px);
}

#item-10 .theme-toggle-label {
  font-size: 13px;
  font-weight: 500;
  color: var(--text-secondary);
  transition: color 0.3s ease;
}

#item-10 .theme-preview-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

#item-10 .theme-preview-card {
  border-radius: var(--radius);
  padding: 20px;
  border: 1px solid;
  transition: all 0.3s ease;
}

#item-10 .theme-preview-card.dark-preview {
  background: #0f1117;
  border-color: #2d3348;
}

#item-10 .theme-preview-card.dark-preview .preview-label {
  color: #94a3b8;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  margin-bottom: 10px;
}

#item-10 .theme-preview-card.dark-preview .preview-title {
  color: #e2e8f0;
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 8px;
}

#item-10 .theme-preview-card.dark-preview .preview-bar-track {
  background: #2d3348;
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 6px;
}

#item-10 .theme-preview-card.dark-preview .preview-bar-fill {
  background: #6366f1;
  height: 100%;
  border-radius: 4px;
  width: 65%;
}

#item-10 .theme-preview-card.dark-preview .preview-stat {
  color: #64748b;
  font-size: 12px;
}

#item-10 .theme-preview-card.light-preview {
  background: #f8fafc;
  border-color: #e2e8f0;
}

#item-10 .theme-preview-card.light-preview .preview-label {
  color: #64748b;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  margin-bottom: 10px;
}

#item-10 .theme-preview-card.light-preview .preview-title {
  color: #1e293b;
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 8px;
}

#item-10 .theme-preview-card.light-preview .preview-bar-track {
  background: #e2e8f0;
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 6px;
}

#item-10 .theme-preview-card.light-preview .preview-bar-fill {
  background: #6366f1;
  height: 100%;
  border-radius: 4px;
  width: 65%;
}

#item-10 .theme-preview-card.light-preview .preview-stat {
  color: #94a3b8;
  font-size: 12px;
}

/* Live demo area that actually toggles */
#item-10 .live-theme-demo {
  margin-top: 16px;
  border-radius: var(--radius);
  padding: 20px;
  transition: all 0.4s ease;
  background: var(--bg-card);
  border: 1px solid var(--border);
}

#item-10 .live-theme-demo.light-mode {
  background: #ffffff;
  border-color: #e2e8f0;
}

#item-10 .live-theme-demo .live-demo-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 12px;
  font-weight: 600;
  color: var(--text-muted);
  transition: color 0.4s ease;
}

#item-10 .live-theme-demo.light-mode .live-demo-label {
  color: #64748b;
}

#item-10 .live-theme-demo .live-demo-content {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

#item-10 .live-demo-stat {
  padding: 14px;
  border-radius: 8px;
  background: var(--bg-primary);
  border: 1px solid var(--border);
  transition: all 0.4s ease;
}

#item-10 .live-theme-demo.light-mode .live-demo-stat {
  background: #f8fafc;
  border-color: #e2e8f0;
}

#item-10 .live-demo-stat .stat-value {
  font-size: 22px;
  font-weight: 700;
  color: var(--text-primary);
  transition: color 0.4s ease;
}

#item-10 .live-theme-demo.light-mode .live-demo-stat .stat-value {
  color: #1e293b;
}

#item-10 .live-demo-stat .stat-label {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 2px;
  transition: color 0.4s ease;
}

#item-10 .live-theme-demo.light-mode .live-demo-stat .stat-label {
  color: #94a3b8;
}

/* --- Clickable Everything (Item 11) --- */
#item-11 .interactive-table-wrap {
  overflow-x: auto;
}

#item-11 .interactive-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  font-size: 13px;
}

#item-11 .interactive-table thead th {
  text-align: left;
  padding: 10px 16px;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  color: var(--text-muted);
  border-bottom: 1px solid var(--border);
  font-weight: 600;
}

#item-11 .interactive-table tbody td {
  padding: 12px 16px;
  border-bottom: 1px solid rgba(45, 51, 72, 0.4);
  vertical-align: middle;
}

#item-11 .interactive-table tbody tr {
  transition: background 0.15s ease;
}

#item-11 .interactive-table tbody tr:hover {
  background: var(--bg-card-hover);
}

#item-11 .interactive-table tbody tr:last-child td {
  border-bottom: none;
}

#item-11 .clickable-link {
  color: #818cf8;
  cursor: pointer;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.15s ease;
  position: relative;
  border-bottom: 1px solid transparent;
}

#item-11 .clickable-link:hover {
  color: #a5b4fc;
  border-bottom-color: #a5b4fc;
}

#item-11 .clickable-status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  padding: 3px 10px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
  transition: all 0.15s ease;
  position: relative;
}

#item-11 .clickable-status:hover {
  transform: translateY(-1px);
}

#item-11 .clickable-status.status-in_progress {
  background: rgba(99, 102, 241, 0.15);
  color: #a5b4fc;
}

#item-11 .clickable-status.status-in_progress:hover {
  background: rgba(99, 102, 241, 0.25);
}

#item-11 .clickable-status.status-review {
  background: rgba(245, 158, 11, 0.15);
  color: #fbbf24;
}

#item-11 .clickable-status.status-review:hover {
  background: rgba(245, 158, 11, 0.25);
}

#item-11 .clickable-status .status-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
}

#item-11 .status-in_progress .status-dot {
  background: #818cf8;
}

#item-11 .status-review .status-dot {
  background: #f59e0b;
}

#item-11 .clickable-assignee {
  color: var(--text-primary);
  cursor: pointer;
  font-weight: 500;
  font-size: 12px;
  padding: 3px 8px;
  border-radius: 6px;
  transition: all 0.15s ease;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

#item-11 .clickable-assignee:hover {
  background: rgba(99, 102, 241, 0.1);
  color: #a5b4fc;
}

#item-11 .clickable-assignee .assignee-icon {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  flex-shrink: 0;
}

#item-11 .assignee-icon.agent {
  background: rgba(99, 102, 241, 0.2);
  color: #818cf8;
}

#item-11 .assignee-icon.human {
  background: rgba(34, 197, 94, 0.2);
  color: #22c55e;
}

#item-11 .events-count {
  font-variant-numeric: tabular-nums;
  color: var(--text-secondary);
  font-weight: 500;
}

/* Tooltip for filter hint */
#item-11 .filter-tooltip {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: #1e2235;
  color: #e2e8f0;
  padding: 5px 10px;
  border-radius: 6px;
  font-size: 11px;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease, transform 0.2s ease;
  z-index: 10;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

#item-11 .filter-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 5px solid transparent;
  border-top-color: #1e2235;
}

#item-11 .clickable-status:hover .filter-tooltip {
  opacity: 1;
  transform: translateX(-50%) translateY(-2px);
}

/* Toast */
.s5-toast {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background: var(--bg-card);
  color: var(--text-primary);
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 13px;
  font-weight: 500;
  z-index: 9999;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  border: 1px solid var(--border);
  transform: translateY(20px);
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-family: var(--font);
  display: flex;
  align-items: center;
  gap: 8px;
  max-width: 380px;
}

.s5-toast.visible {
  transform: translateY(0);
  opacity: 1;
}

.s5-toast .toast-icon {
  flex-shrink: 0;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
}

.s5-toast .toast-icon.nav {
  background: rgba(99, 102, 241, 0.2);
  color: #818cf8;
}

.s5-toast .toast-icon.copy {
  background: rgba(34, 197, 94, 0.2);
  color: #22c55e;
}

/* --- Time Range Selector (Item 12) --- */
#item-12 .time-range-container {
  position: relative;
}

#item-12 .time-range-pills {
  display: inline-flex;
  background: var(--bg-primary);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 4px;
  position: relative;
  margin-bottom: 20px;
}

#item-12 .time-range-slider {
  position: absolute;
  top: 4px;
  height: calc(100% - 8px);
  background: var(--accent);
  border-radius: 7px;
  transition: left 0.35s cubic-bezier(0.4, 0, 0.2, 1), width 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 0;
  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
}

#item-12 .time-range-pill {
  position: relative;
  z-index: 1;
  padding: 7px 20px;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-secondary);
  cursor: pointer;
  user-select: none;
  transition: color 0.25s ease;
  border-radius: 7px;
  white-space: nowrap;
}

#item-12 .time-range-pill.active {
  color: #fff;
}

#item-12 .time-range-pill:hover:not(.active) {
  color: var(--text-primary);
}

#item-12 .time-range-output {
  background: var(--bg-card);
  border: 1px dashed var(--border);
  border-radius: var(--radius);
  padding: 24px;
  text-align: center;
  color: var(--text-secondary);
  font-size: 14px;
  transition: all 0.3s ease;
}

#item-12 .time-range-output .range-icon {
  font-size: 28px;
  margin-bottom: 8px;
  display: block;
  opacity: 0.6;
}

#item-12 .time-range-output .range-label {
  font-weight: 600;
  color: var(--accent);
}

/* --- Collapsible Sections (Item 13) --- */
#item-13 .collapsible-section {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-bottom: 10px;
  overflow: hidden;
  transition: border-color 0.2s ease;
}

#item-13 .collapsible-section:hover {
  border-color: rgba(99, 102, 241, 0.3);
}

#item-13 .collapsible-header {
  display: flex;
  align-items: center;
  padding: 14px 18px;
  cursor: pointer;
  user-select: none;
  gap: 10px;
  transition: background 0.15s ease;
}

#item-13 .collapsible-header:hover {
  background: var(--bg-card-hover);
}

#item-13 .collapsible-chevron {
  font-size: 14px;
  color: var(--text-muted);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  flex-shrink: 0;
  width: 18px;
  text-align: center;
}

#item-13 .collapsible-section.expanded .collapsible-chevron {
  transform: rotate(90deg);
}

#item-13 .collapsible-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  flex: 1;
}

#item-13 .collapsible-summary {
  font-size: 11px;
  color: var(--text-muted);
  transition: opacity 0.25s ease;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 340px;
}

#item-13 .collapsible-section.expanded .collapsible-summary {
  opacity: 0;
  width: 0;
  max-width: 0;
  overflow: hidden;
}

#item-13 .collapsible-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), padding 0.3s ease;
  padding: 0 18px;
}

#item-13 .collapsible-section.expanded .collapsible-body {
  max-height: 400px;
  padding: 0 18px 18px;
}

#item-13 .collapsible-bar-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
}

#item-13 .collapsible-bar-row:last-child {
  margin-bottom: 0;
}

#item-13 .bar-label {
  font-size: 12px;
  color: var(--text-secondary);
  min-width: 80px;
  font-weight: 500;
}

#item-13 .bar-track {
  flex: 1;
  height: 8px;
  background: var(--bg-primary);
  border-radius: 4px;
  overflow: hidden;
}

#item-13 .bar-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.5s ease;
}

#item-13 .bar-value {
  font-size: 12px;
  color: var(--text-muted);
  min-width: 28px;
  text-align: right;
  font-variant-numeric: tabular-nums;
}

/* --- Export / Share (Item 20) --- */
#item-20 .export-panel {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}

#item-20 .export-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 16px 12px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.2s ease;
  user-select: none;
}

#item-20 .export-btn:hover {
  border-color: var(--accent);
  background: var(--bg-card-hover);
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(99, 102, 241, 0.15);
}

#item-20 .export-btn:active {
  transform: translateY(0);
}

#item-20 .export-btn .export-icon {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}

#item-20 .export-btn .export-icon.md-icon {
  background: rgba(99, 102, 241, 0.15);
  color: #818cf8;
}

#item-20 .export-btn .export-icon.json-icon {
  background: rgba(34, 197, 94, 0.15);
  color: #22c55e;
}

#item-20 .export-btn .export-icon.report-icon {
  background: rgba(245, 158, 11, 0.15);
  color: #f59e0b;
}

#item-20 .export-btn .export-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-primary);
}

#item-20 .export-btn .export-sublabel {
  font-size: 10px;
  color: var(--text-muted);
}

#item-20 .export-preview {
  background: var(--bg-primary);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  transition: all 0.3s ease;
}

#item-20 .export-preview-header {
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
}

#item-20 .export-preview-title {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
  font-weight: 600;
}

#item-20 .export-preview-badge {
  font-size: 10px;
  padding: 2px 8px;
  border-radius: 4px;
  font-weight: 600;
}

#item-20 .export-preview-badge.md-badge {
  background: rgba(99, 102, 241, 0.15);
  color: #818cf8;
}

#item-20 .export-preview-badge.json-badge {
  background: rgba(34, 197, 94, 0.15);
  color: #22c55e;
}

#item-20 .export-preview-badge.report-badge {
  background: rgba(245, 158, 11, 0.15);
  color: #f59e0b;
}

#item-20 .export-preview-body {
  padding: 14px 16px;
  max-height: 260px;
  overflow-y: auto;
}

#item-20 .export-preview-body pre {
  margin: 0;
  font-size: 12px;
  line-height: 1.6;
  color: var(--text-secondary);
  white-space: pre-wrap;
  word-break: break-word;
  font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace;
}

#item-20 .export-preview-body pre .hl-heading {
  color: #818cf8;
  font-weight: 700;
}

#item-20 .export-preview-body pre .hl-bold {
  color: var(--text-primary);
  font-weight: 600;
}

#item-20 .export-preview-body pre .hl-key {
  color: #818cf8;
}

#item-20 .export-preview-body pre .hl-string {
  color: #22c55e;
}

#item-20 .export-preview-body pre .hl-number {
  color: #f59e0b;
}

#item-20 .export-preview-body pre .hl-arrow {
  color: var(--text-muted);
}

/* --- Recommended Actions (Item 26) --- */
#item-26 .actions-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

#item-26 .action-card {
  display: flex;
  gap: 14px;
  padding: 16px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  transition: all 0.2s ease;
  cursor: default;
}

#item-26 .action-card:hover {
  border-color: rgba(99, 102, 241, 0.25);
  background: var(--bg-card-hover);
  transform: translateX(3px);
}

#item-26 .action-severity {
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding-top: 2px;
}

#item-26 .severity-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}

#item-26 .severity-dot.critical { background: #ef4444; box-shadow: 0 0 8px rgba(239, 68, 68, 0.4); }
#item-26 .severity-dot.high     { background: #f97316; box-shadow: 0 0 8px rgba(249, 115, 22, 0.3); }
#item-26 .severity-dot.medium   { background: #eab308; box-shadow: 0 0 8px rgba(234, 179, 8, 0.3); }
#item-26 .severity-dot.low      { background: #3b82f6; box-shadow: 0 0 8px rgba(59, 130, 246, 0.3); }
#item-26 .severity-dot.info     { background: #6b7280; }

#item-26 .severity-line {
  width: 2px;
  flex: 1;
  background: var(--border);
  border-radius: 1px;
  min-height: 20px;
}

#item-26 .action-content {
  flex: 1;
  min-width: 0;
}

#item-26 .action-headline {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
  line-height: 1.4;
}

#item-26 .action-headline .action-task-ref {
  color: #818cf8;
  cursor: pointer;
  border-bottom: 1px solid transparent;
  transition: all 0.15s ease;
}

#item-26 .action-headline .action-task-ref:hover {
  color: #a5b4fc;
  border-bottom-color: #a5b4fc;
}

#item-26 .action-context {
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 6px;
  line-height: 1.5;
}

#item-26 .action-recommendation {
  font-size: 12px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 6px;
}

#item-26 .action-recommendation .arrow {
  color: var(--accent);
  font-weight: 700;
  font-size: 14px;
}

#item-26 .action-recommendation .rec-text {
  font-weight: 500;
}

#item-26 .action-number {
  font-size: 10px;
  color: var(--text-muted);
  font-weight: 700;
  font-variant-numeric: tabular-nums;
}
</style>

<div class="demo-group" id="group-5">

  <!-- ===== Item 10: Dark Mode / Theme-Aware ===== -->
  <div class="demo-item" id="item-10">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9321;</span>
      <h3>Dark Mode / Theme-Aware</h3>
      <span class="demo-item-tag">Polish</span>
    </div>
    <div class="demo-item-body">
      <div class="theme-demo-area">
        <div class="theme-toggle-wrap">
          <div class="theme-toggle" id="s5-theme-toggle" onclick="s5ToggleTheme()">
            <span class="theme-toggle-label" id="s5-theme-label">Dark</span>
            <div class="theme-toggle-track" id="s5-theme-track">
              <div class="theme-toggle-thumb"></div>
            </div>
          </div>
        </div>

        <!-- Side-by-side preview cards -->
        <div class="theme-preview-row">
          <div class="theme-preview-card dark-preview">
            <div class="preview-label">Dark Mode</div>
            <div class="preview-title">Task Completion</div>
            <div class="preview-bar-track"><div class="preview-bar-fill"></div></div>
            <div class="preview-stat">65% of sprint complete</div>
          </div>
          <div class="theme-preview-card light-preview">
            <div class="preview-label">Light Mode</div>
            <div class="preview-title">Task Completion</div>
            <div class="preview-bar-track"><div class="preview-bar-fill"></div></div>
            <div class="preview-stat">65% of sprint complete</div>
          </div>
        </div>

        <!-- Live toggling demo -->
        <div class="live-theme-demo" id="s5-live-demo">
          <div class="live-demo-label">Live Preview (toggle above)</div>
          <div class="live-demo-content">
            <div class="live-demo-stat">
              <div class="stat-value">32</div>
              <div class="stat-label">Active Tasks</div>
            </div>
            <div class="live-demo-stat">
              <div class="stat-value">72</div>
              <div class="stat-label">Health Score</div>
            </div>
            <div class="live-demo-stat">
              <div class="stat-value">5.3d</div>
              <div class="stat-label">Avg Cycle</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Item 11: Clickable Everything ===== -->
  <div class="demo-item" id="item-11">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9322;</span>
      <h3>Clickable Everything</h3>
      <span class="demo-item-tag">Polish</span>
    </div>
    <div class="demo-item-body">
      <div class="interactive-table-wrap">
        <table class="interactive-table">
          <thead>
            <tr>
              <th>Task</th>
              <th>Status</th>
              <th>Assignee</th>
              <th>Events</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <span class="clickable-link" onclick="s5ShowToast('nav', 'Would navigate to: LAT-47 detail view')">LAT-47</span>
              </td>
              <td>
                <span class="clickable-status status-in_progress" onclick="s5ShowToast('nav', 'Would filter by: status = in_progress')">
                  <span class="status-dot"></span>
                  in_progress
                  <span class="filter-tooltip">Click to filter by in_progress</span>
                </span>
              </td>
              <td>
                <span class="clickable-assignee" onclick="s5ShowToast('nav', 'Would navigate to: agent:claude-opus-4 profile')">
                  <span class="assignee-icon agent">C</span>
                  agent:claude-opus-4
                </span>
              </td>
              <td><span class="events-count">12</span></td>
            </tr>
            <tr>
              <td>
                <span class="clickable-link" onclick="s5ShowToast('nav', 'Would navigate to: LAT-45 detail view')">LAT-45</span>
              </td>
              <td>
                <span class="clickable-status status-review" onclick="s5ShowToast('nav', 'Would filter by: status = review')">
                  <span class="status-dot"></span>
                  review
                  <span class="filter-tooltip">Click to filter by review</span>
                </span>
              </td>
              <td>
                <span class="clickable-assignee" onclick="s5ShowToast('nav', 'Would navigate to: human:atin profile')">
                  <span class="assignee-icon human">A</span>
                  human:atin
                </span>
              </td>
              <td><span class="events-count">8</span></td>
            </tr>
            <tr>
              <td>
                <span class="clickable-link" onclick="s5ShowToast('nav', 'Would navigate to: LAT-42 detail view')">LAT-42</span>
              </td>
              <td>
                <span class="clickable-status status-in_progress" onclick="s5ShowToast('nav', 'Would filter by: status = in_progress')">
                  <span class="status-dot"></span>
                  in_progress
                  <span class="filter-tooltip">Click to filter by in_progress</span>
                </span>
              </td>
              <td>
                <span class="clickable-assignee" onclick="s5ShowToast('nav', 'Would navigate to: agent:codex profile')">
                  <span class="assignee-icon agent">X</span>
                  agent:codex
                </span>
              </td>
              <td><span class="events-count">15</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ===== Item 12: Time Range Selector ===== -->
  <div class="demo-item" id="item-12">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9323;</span>
      <h3>Time Range Selector</h3>
      <span class="demo-item-tag">Polish</span>
    </div>
    <div class="demo-item-body">
      <div class="time-range-container">
        <div class="time-range-pills" id="s5-time-pills">
          <div class="time-range-slider" id="s5-time-slider"></div>
          <div class="time-range-pill" data-range="7d" onclick="s5SelectRange(this)">7d</div>
          <div class="time-range-pill active" data-range="30d" onclick="s5SelectRange(this)">30d</div>
          <div class="time-range-pill" data-range="90d" onclick="s5SelectRange(this)">90d</div>
          <div class="time-range-pill" data-range="All" onclick="s5SelectRange(this)">All</div>
        </div>
        <div class="time-range-output" id="s5-range-output">
          <span class="range-icon">&#128200;</span>
          Chart data would update to show: <span class="range-label">last 30 days</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Item 13: Collapsible Sections ===== -->
  <div class="demo-item" id="item-13">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9324;</span>
      <h3>Collapsible Sections</h3>
      <span class="demo-item-tag">Polish</span>
    </div>
    <div class="demo-item-body">
      <!-- Section 1: Status Distribution (expanded) -->
      <div class="collapsible-section expanded" id="s5-collapse-status">
        <div class="collapsible-header" onclick="s5ToggleCollapse('s5-collapse-status')">
          <span class="collapsible-chevron">&#9656;</span>
          <span class="collapsible-title">Status Distribution</span>
          <span class="collapsible-summary">5 in_progress, 3 review, 12 done...</span>
        </div>
        <div class="collapsible-body">
          <div class="collapsible-bar-row">
            <span class="bar-label">in_progress</span>
            <div class="bar-track"><div class="bar-fill" style="width:42%; background: var(--accent);"></div></div>
            <span class="bar-value">5</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">review</span>
            <div class="bar-track"><div class="bar-fill" style="width:25%; background: var(--warning);"></div></div>
            <span class="bar-value">3</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">planned</span>
            <div class="bar-track"><div class="bar-fill" style="width:33%; background: #22d3ee;"></div></div>
            <span class="bar-value">4</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">done</span>
            <div class="bar-track"><div class="bar-fill" style="width:100%; background: var(--success);"></div></div>
            <span class="bar-value">12</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">backlog</span>
            <div class="bar-track"><div class="bar-fill" style="width:67%; background: var(--text-muted);"></div></div>
            <span class="bar-value">8</span>
          </div>
        </div>
      </div>

      <!-- Section 2: Priority Breakdown (collapsed) -->
      <div class="collapsible-section" id="s5-collapse-priority">
        <div class="collapsible-header" onclick="s5ToggleCollapse('s5-collapse-priority')">
          <span class="collapsible-chevron">&#9656;</span>
          <span class="collapsible-title">Priority Breakdown</span>
          <span class="collapsible-summary">2 urgent, 7 high, 15 normal, 8 low</span>
        </div>
        <div class="collapsible-body">
          <div class="collapsible-bar-row">
            <span class="bar-label">Urgent</span>
            <div class="bar-track"><div class="bar-fill" style="width:13%; background: var(--danger);"></div></div>
            <span class="bar-value">2</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">High</span>
            <div class="bar-track"><div class="bar-fill" style="width:47%; background: #f97316;"></div></div>
            <span class="bar-value">7</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">Normal</span>
            <div class="bar-track"><div class="bar-fill" style="width:100%; background: var(--accent);"></div></div>
            <span class="bar-value">15</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">Low</span>
            <div class="bar-track"><div class="bar-fill" style="width:53%; background: var(--text-muted);"></div></div>
            <span class="bar-value">8</span>
          </div>
        </div>
      </div>

      <!-- Section 3: Tag Distribution (collapsed) -->
      <div class="collapsible-section" id="s5-collapse-tags">
        <div class="collapsible-header" onclick="s5ToggleCollapse('s5-collapse-tags')">
          <span class="collapsible-chevron">&#9656;</span>
          <span class="collapsible-title">Tag Distribution</span>
          <span class="collapsible-summary">core: 11, cli: 8, dashboard: 5, storage: 4</span>
        </div>
        <div class="collapsible-body">
          <div class="collapsible-bar-row">
            <span class="bar-label">core</span>
            <div class="bar-track"><div class="bar-fill" style="width:100%; background: var(--accent);"></div></div>
            <span class="bar-value">11</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">cli</span>
            <div class="bar-track"><div class="bar-fill" style="width:73%; background: #22d3ee;"></div></div>
            <span class="bar-value">8</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">dashboard</span>
            <div class="bar-track"><div class="bar-fill" style="width:45%; background: var(--warning);"></div></div>
            <span class="bar-value">5</span>
          </div>
          <div class="collapsible-bar-row">
            <span class="bar-label">storage</span>
            <div class="bar-track"><div class="bar-fill" style="width:36%; background: var(--success);"></div></div>
            <span class="bar-value">4</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Item 20: Export / Share ===== -->
  <div class="demo-item" id="item-20">
    <div class="demo-item-header">
      <span class="demo-item-number">&#9331;</span>
      <h3>Export / Share</h3>
      <span class="demo-item-tag">Feature</span>
    </div>
    <div class="demo-item-body">
      <div class="export-panel">
        <div class="export-btn" onclick="s5ShowExportPreview('markdown')">
          <div class="export-icon md-icon">&#9997;</div>
          <div class="export-label">Copy as Markdown</div>
          <div class="export-sublabel">Clipboard-ready</div>
        </div>
        <div class="export-btn" onclick="s5ShowExportPreview('json')">
          <div class="export-icon json-icon">{}</div>
          <div class="export-label">Export JSON</div>
          <div class="export-sublabel">Machine-readable</div>
        </div>
        <div class="export-btn" onclick="s5ShowExportPreview('report')">
          <div class="export-icon report-icon">&#128196;</div>
          <div class="export-label">Generate Report</div>
          <div class="export-sublabel">Formatted summary</div>
        </div>
      </div>

      <div class="export-preview" id="s5-export-preview">
        <div class="export-preview-header">
          <span class="export-preview-title" id="s5-preview-title">Preview</span>
          <span class="export-preview-badge md-badge" id="s5-preview-badge">Markdown</span>
        </div>
        <div class="export-preview-body">
          <pre id="s5-preview-content"><span class="hl-heading">## Lattice Stats &mdash; Feb 15, 2026</span>
- <span class="hl-bold">Active tasks:</span> 32 (&uarr;3 from last week)
- <span class="hl-bold">Completed this week:</span> 3
- <span class="hl-bold">Health:</span> Partly Cloudy (72/100)
- <span class="hl-bold">Bottleneck:</span> review (avg 12.7d)
- <span class="hl-bold">Attention:</span> LAT-18 stale 12d, blocking 2 tasks</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Item 26: Top 5 Recommended Actions ===== -->
  <div class="demo-item" id="item-26">
    <div class="demo-item-header">
      <span class="demo-item-number">&#12886;</span>
      <h3>Top 5 Recommended Actions</h3>
      <span class="demo-item-tag">Feature</span>
    </div>
    <div class="demo-item-body">
      <div class="actions-list">
        <!-- Action 1 -->
        <div class="action-card">
          <div class="action-severity">
            <div class="severity-dot critical"></div>
            <div class="severity-line"></div>
          </div>
          <div class="action-content">
            <div class="action-headline">
              Unblock <span class="action-task-ref" onclick="s5ShowToast('nav', 'Would navigate to: LAT-18 detail view')">LAT-18</span> &mdash; "Add relationship validation"
            </div>
            <div class="action-context">Stale 12d in in_progress, blocking LAT-31 and LAT-33 (chain depth 2)</div>
            <div class="action-recommendation">
              <span class="arrow">&rarr;</span>
              <span class="rec-text">Review and resolve or reassign</span>
            </div>
          </div>
        </div>

        <!-- Action 2 -->
        <div class="action-card">
          <div class="action-severity">
            <div class="severity-dot high"></div>
            <div class="severity-line"></div>
          </div>
          <div class="action-content">
            <div class="action-headline">
              Reduce WIP &mdash; in_progress at 5/4 limit
            </div>
            <div class="action-context">Consider moving <span class="action-task-ref" onclick="s5ShowToast('nav', 'Would navigate to: LAT-38 detail view')">LAT-38</span> "Add tag filtering" to review</div>
            <div class="action-recommendation">
              <span class="arrow">&rarr;</span>
              <span class="rec-text">Move oldest in_progress task forward</span>
            </div>
          </div>
        </div>

        <!-- Action 3 -->
        <div class="action-card">
          <div class="action-severity">
            <div class="severity-dot medium"></div>
            <div class="severity-line"></div>
          </div>
          <div class="action-content">
            <div class="action-headline">
              Assign <span class="action-task-ref" onclick="s5ShowToast('nav', 'Would navigate to: LAT-22 detail view')">LAT-22</span> &mdash; "Design artifact linking UX"
            </div>
            <div class="action-context">Planned but unassigned for 14 days, stale</div>
            <div class="action-recommendation">
              <span class="arrow">&rarr;</span>
              <span class="rec-text">Assign to available agent or deprioritize</span>
            </div>
          </div>
        </div>

        <!-- Action 4 -->
        <div class="action-card">
          <div class="action-severity">
            <div class="severity-dot low"></div>
            <div class="severity-line"></div>
          </div>
          <div class="action-content">
            <div class="action-headline">
              Review <span class="action-task-ref" onclick="s5ShowToast('nav', 'Would navigate to: LAT-45 detail view')">LAT-45</span> &mdash; "Fix event replay ordering"
            </div>
            <div class="action-context">In review for 5h, all tests passing</div>
            <div class="action-recommendation">
              <span class="arrow">&rarr;</span>
              <span class="rec-text">Merge if approved</span>
            </div>
          </div>
        </div>

        <!-- Action 5 -->
        <div class="action-card">
          <div class="action-severity">
            <div class="severity-dot info"></div>
          </div>
          <div class="action-content">
            <div class="action-headline">
              Plan next sprint &mdash; 4 tasks in backlog
            </div>
            <div class="action-context"><span class="action-task-ref" onclick="s5ShowToast('nav', 'Would navigate to: LAT-35 detail view')">LAT-35</span> (high priority) and <span class="action-task-ref" onclick="s5ShowToast('nav', 'Would navigate to: LAT-34 detail view')">LAT-34</span> ready for planning</div>
            <div class="action-recommendation">
              <span class="arrow">&rarr;</span>
              <span class="rec-text">Move highest-priority backlog items to planned</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div><!-- /group-5 -->

<script>
(function() {
  'use strict';

  // === Toast system ===
  let s5ToastTimeout = null;
  window.s5ShowToast = function(type, message) {
    // Remove existing toast
    const existing = document.querySelector('.s5-toast');
    if (existing) existing.remove();
    if (s5ToastTimeout) clearTimeout(s5ToastTimeout);

    const toast = document.createElement('div');
    toast.className = 's5-toast';
    const iconClass = type === 'copy' ? 'copy' : 'nav';
    const iconChar = type === 'copy' ? '\u2713' : '\u2192';
    toast.innerHTML = '<div class="toast-icon ' + iconClass + '">' + iconChar + '</div><span>' + message + '</span>';
    document.body.appendChild(toast);

    // Trigger animation
    requestAnimationFrame(function() {
      requestAnimationFrame(function() {
        toast.classList.add('visible');
      });
    });

    s5ToastTimeout = setTimeout(function() {
      toast.classList.remove('visible');
      setTimeout(function() { toast.remove(); }, 300);
    }, 2500);
  };

  // === Item 10: Theme toggle ===
  let s5DarkMode = true;
  window.s5ToggleTheme = function() {
    s5DarkMode = !s5DarkMode;
    const track = document.getElementById('s5-theme-track');
    const label = document.getElementById('s5-theme-label');
    const demo = document.getElementById('s5-live-demo');

    if (s5DarkMode) {
      track.classList.remove('active');
      label.textContent = 'Dark';
      demo.classList.remove('light-mode');
    } else {
      track.classList.add('active');
      label.textContent = 'Light';
      demo.classList.add('light-mode');
    }
  };

  // === Item 12: Time Range Selector ===
  const rangeLabels = {
    '7d': 'last 7 days',
    '30d': 'last 30 days',
    '90d': 'last 90 days',
    'All': 'all time'
  };

  function s5UpdateSlider() {
    const pills = document.getElementById('s5-time-pills');
    if (!pills) return;
    const active = pills.querySelector('.time-range-pill.active');
    const slider = document.getElementById('s5-time-slider');
    if (!active || !slider) return;

    const pillsRect = pills.getBoundingClientRect();
    const activeRect = active.getBoundingClientRect();
    slider.style.left = (activeRect.left - pillsRect.left) + 'px';
    slider.style.width = activeRect.width + 'px';
  }

  window.s5SelectRange = function(el) {
    const pills = document.querySelectorAll('#item-12 .time-range-pill');
    pills.forEach(function(p) { p.classList.remove('active'); });
    el.classList.add('active');

    const range = el.getAttribute('data-range');
    const output = document.getElementById('s5-range-output');
    if (output) {
      output.innerHTML = '<span class="range-icon">\uD83D\uDCC8</span>Chart data would update to show: <span class="range-label">' + rangeLabels[range] + '</span>';
    }

    s5UpdateSlider();
  };

  // Initialize slider position after DOM ready
  requestAnimationFrame(function() {
    setTimeout(s5UpdateSlider, 50);
  });
  window.addEventListener('resize', s5UpdateSlider);

  // === Item 13: Collapsible sections ===
  window.s5ToggleCollapse = function(id) {
    var section = document.getElementById(id);
    if (!section) return;
    section.classList.toggle('expanded');
  };

  // === Item 20: Export preview ===
  var exportData = {
    markdown: {
      title: 'Markdown Preview',
      badge: 'Markdown',
      badgeClass: 'md-badge',
      content: '<span class="hl-heading">## Lattice Stats \u2014 Feb 15, 2026</span>\n- <span class="hl-bold">Active tasks:</span> 32 (\u2191 3 from last week)\n- <span class="hl-bold">Completed this week:</span> 3\n- <span class="hl-bold">Health:</span> Partly Cloudy (72/100)\n- <span class="hl-bold">Bottleneck:</span> review (avg 12.7d)\n- <span class="hl-bold">Attention:</span> LAT-18 stale 12d, blocking 2 tasks'
    },
    json: {
      title: 'JSON Output',
      badge: 'JSON',
      badgeClass: 'json-badge',
      content: '{\n  <span class="hl-key">"generated"</span>: <span class="hl-string">"2026-02-15T12:00:00Z"</span>,\n  <span class="hl-key">"active_tasks"</span>: <span class="hl-number">32</span>,\n  <span class="hl-key">"completed_this_week"</span>: <span class="hl-number">3</span>,\n  <span class="hl-key">"health"</span>: {\n    <span class="hl-key">"score"</span>: <span class="hl-number">72</span>,\n    <span class="hl-key">"label"</span>: <span class="hl-string">"Partly Cloudy"</span>\n  },\n  <span class="hl-key">"bottleneck"</span>: {\n    <span class="hl-key">"status"</span>: <span class="hl-string">"review"</span>,\n    <span class="hl-key">"avg_days"</span>: <span class="hl-number">12.7</span>\n  },\n  <span class="hl-key">"attention"</span>: [{\n    <span class="hl-key">"task"</span>: <span class="hl-string">"LAT-18"</span>,\n    <span class="hl-key">"stale_days"</span>: <span class="hl-number">12</span>,\n    <span class="hl-key">"blocking"</span>: <span class="hl-number">2</span>\n  }]\n}'
    },
    report: {
      title: 'Report Preview',
      badge: 'Report',
      badgeClass: 'report-badge',
      content: '<span class="hl-heading">LATTICE PROJECT REPORT</span>\n<span class="hl-heading">Generated: Feb 15, 2026</span>\n<span class="hl-bold">==================================</span>\n\n<span class="hl-bold">SUMMARY</span>\n  Active tasks:           32 (\u2191 3)\n  Completed this week:     3\n  Health score:           72 / 100\n  Overall status:         Partly Cloudy\n\n<span class="hl-bold">BOTTLENECK ANALYSIS</span>\n  Slowest stage: review (avg 12.7 days)\n  WIP violation: in_progress at 5/4\n\n<span class="hl-bold">ATTENTION REQUIRED</span>\n  <span class="hl-arrow">\u2192</span> LAT-18: stale 12d, blocking 2 tasks\n  <span class="hl-arrow">\u2192</span> LAT-22: unassigned 14d\n  <span class="hl-arrow">\u2192</span> LAT-38: candidate for review'
    }
  };

  window.s5ShowExportPreview = function(type) {
    var data = exportData[type];
    if (!data) return;

    var titleEl = document.getElementById('s5-preview-title');
    var badgeEl = document.getElementById('s5-preview-badge');
    var contentEl = document.getElementById('s5-preview-content');

    if (titleEl) titleEl.textContent = data.title;
    if (badgeEl) {
      badgeEl.textContent = data.badge;
      badgeEl.className = 'export-preview-badge ' + data.badgeClass;
    }
    if (contentEl) contentEl.innerHTML = data.content;

    // Animate the preview container
    var preview = document.getElementById('s5-export-preview');
    if (preview) {
      preview.style.transform = 'scale(0.98)';
      preview.style.opacity = '0.7';
      setTimeout(function() {
        preview.style.transform = 'scale(1)';
        preview.style.opacity = '1';
      }, 150);
    }

    if (type === 'markdown') {
      s5ShowToast('copy', 'Copied to clipboard!');
    }
  };

})();
</script>

</div><!-- /main-content -->
</body>
</html>
